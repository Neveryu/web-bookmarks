<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Angular 高阶内容笔记（超棒） | web-bookmarks</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/web-bookmarks/favicon.ico">
    <link rel="manifest" href="/web-bookmarks/manifest.json">
    <link rel="apple-touch-icon" href="/web-bookmarks/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/web-bookmarks/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="前端工程师知识技能储备库">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/web-bookmarks/assets/css/0.styles.be43791e.css" as="style"><link rel="preload" href="/web-bookmarks/assets/js/app.043910a3.js" as="script"><link rel="preload" href="/web-bookmarks/assets/js/2.74e402c0.js" as="script"><link rel="preload" href="/web-bookmarks/assets/js/1.f201e22a.js" as="script"><link rel="preload" href="/web-bookmarks/assets/js/10.354a13ae.js" as="script"><link rel="prefetch" href="/web-bookmarks/assets/js/100.231b51bb.js"><link rel="prefetch" href="/web-bookmarks/assets/js/101.f5498f86.js"><link rel="prefetch" href="/web-bookmarks/assets/js/102.c26db37d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/103.b0cc39a0.js"><link rel="prefetch" href="/web-bookmarks/assets/js/104.5a2cd4da.js"><link rel="prefetch" href="/web-bookmarks/assets/js/105.b9b69277.js"><link rel="prefetch" href="/web-bookmarks/assets/js/106.01f5594a.js"><link rel="prefetch" href="/web-bookmarks/assets/js/107.f605ce83.js"><link rel="prefetch" href="/web-bookmarks/assets/js/108.fa7e5a0c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/109.42264323.js"><link rel="prefetch" href="/web-bookmarks/assets/js/11.a8e47de5.js"><link rel="prefetch" href="/web-bookmarks/assets/js/110.41c31db5.js"><link rel="prefetch" href="/web-bookmarks/assets/js/111.2dafc22f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/112.dad9ed14.js"><link rel="prefetch" href="/web-bookmarks/assets/js/113.c41ae3ee.js"><link rel="prefetch" href="/web-bookmarks/assets/js/114.fc7348e5.js"><link rel="prefetch" href="/web-bookmarks/assets/js/115.3d563ad4.js"><link rel="prefetch" href="/web-bookmarks/assets/js/116.9784c22f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/117.b67a9457.js"><link rel="prefetch" href="/web-bookmarks/assets/js/118.b7deb08c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/119.6f1f3b64.js"><link rel="prefetch" href="/web-bookmarks/assets/js/12.06e9bc8c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/120.d6707131.js"><link rel="prefetch" href="/web-bookmarks/assets/js/121.5ceabb8d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/122.441d2394.js"><link rel="prefetch" href="/web-bookmarks/assets/js/123.efece045.js"><link rel="prefetch" href="/web-bookmarks/assets/js/124.49659745.js"><link rel="prefetch" href="/web-bookmarks/assets/js/125.0a819290.js"><link rel="prefetch" href="/web-bookmarks/assets/js/126.5f88739e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/127.1b196dc3.js"><link rel="prefetch" href="/web-bookmarks/assets/js/128.6802358e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/129.5751c9a2.js"><link rel="prefetch" href="/web-bookmarks/assets/js/13.bc188b8d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/130.b01b7d74.js"><link rel="prefetch" href="/web-bookmarks/assets/js/131.a5f15a06.js"><link rel="prefetch" href="/web-bookmarks/assets/js/132.d815753b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/133.185f56bf.js"><link rel="prefetch" href="/web-bookmarks/assets/js/134.c3b852e0.js"><link rel="prefetch" href="/web-bookmarks/assets/js/135.0d853f1e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/136.25f20919.js"><link rel="prefetch" href="/web-bookmarks/assets/js/137.9be2d448.js"><link rel="prefetch" href="/web-bookmarks/assets/js/138.081afdec.js"><link rel="prefetch" href="/web-bookmarks/assets/js/139.2cccf885.js"><link rel="prefetch" href="/web-bookmarks/assets/js/14.c5247a30.js"><link rel="prefetch" href="/web-bookmarks/assets/js/140.5311f103.js"><link rel="prefetch" href="/web-bookmarks/assets/js/141.1529e261.js"><link rel="prefetch" href="/web-bookmarks/assets/js/142.13f2174c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/143.670e3891.js"><link rel="prefetch" href="/web-bookmarks/assets/js/144.17eba443.js"><link rel="prefetch" href="/web-bookmarks/assets/js/145.d1d6955f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/146.cbb5b245.js"><link rel="prefetch" href="/web-bookmarks/assets/js/147.7aef7fc1.js"><link rel="prefetch" href="/web-bookmarks/assets/js/148.f2005ee4.js"><link rel="prefetch" href="/web-bookmarks/assets/js/149.20d4aa3c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/15.b9a8a903.js"><link rel="prefetch" href="/web-bookmarks/assets/js/150.4aa464ee.js"><link rel="prefetch" href="/web-bookmarks/assets/js/151.428c8d49.js"><link rel="prefetch" href="/web-bookmarks/assets/js/152.8e1b17d7.js"><link rel="prefetch" href="/web-bookmarks/assets/js/153.51091464.js"><link rel="prefetch" href="/web-bookmarks/assets/js/154.281767d3.js"><link rel="prefetch" href="/web-bookmarks/assets/js/155.10b64bf7.js"><link rel="prefetch" href="/web-bookmarks/assets/js/156.c5447594.js"><link rel="prefetch" href="/web-bookmarks/assets/js/157.e2af1ed6.js"><link rel="prefetch" href="/web-bookmarks/assets/js/158.2d6ab937.js"><link rel="prefetch" href="/web-bookmarks/assets/js/159.ccf0689e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/16.7f863943.js"><link rel="prefetch" href="/web-bookmarks/assets/js/160.08428253.js"><link rel="prefetch" href="/web-bookmarks/assets/js/161.2c3b466e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/162.2014651f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/163.fdf191ce.js"><link rel="prefetch" href="/web-bookmarks/assets/js/164.aa1ad3d8.js"><link rel="prefetch" href="/web-bookmarks/assets/js/165.424c54d6.js"><link rel="prefetch" href="/web-bookmarks/assets/js/166.6e8de4a3.js"><link rel="prefetch" href="/web-bookmarks/assets/js/167.a32a2479.js"><link rel="prefetch" href="/web-bookmarks/assets/js/168.e97d4a60.js"><link rel="prefetch" href="/web-bookmarks/assets/js/169.9fff1328.js"><link rel="prefetch" href="/web-bookmarks/assets/js/17.355cc133.js"><link rel="prefetch" href="/web-bookmarks/assets/js/170.fd25af6a.js"><link rel="prefetch" href="/web-bookmarks/assets/js/171.aefc06ba.js"><link rel="prefetch" href="/web-bookmarks/assets/js/172.e6ecf8fb.js"><link rel="prefetch" href="/web-bookmarks/assets/js/173.6e4a9322.js"><link rel="prefetch" href="/web-bookmarks/assets/js/174.3b178aae.js"><link rel="prefetch" href="/web-bookmarks/assets/js/175.a83ec2ab.js"><link rel="prefetch" href="/web-bookmarks/assets/js/176.1dc51a14.js"><link rel="prefetch" href="/web-bookmarks/assets/js/177.a6388d19.js"><link rel="prefetch" href="/web-bookmarks/assets/js/178.f8077315.js"><link rel="prefetch" href="/web-bookmarks/assets/js/179.17dbc6fe.js"><link rel="prefetch" href="/web-bookmarks/assets/js/18.ae544204.js"><link rel="prefetch" href="/web-bookmarks/assets/js/180.8e626bdc.js"><link rel="prefetch" href="/web-bookmarks/assets/js/181.6b698508.js"><link rel="prefetch" href="/web-bookmarks/assets/js/182.97e86b0f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/183.9b3e1c13.js"><link rel="prefetch" href="/web-bookmarks/assets/js/184.b51e8e6b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/185.465bc4d8.js"><link rel="prefetch" href="/web-bookmarks/assets/js/186.6c59415b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/187.f5fc33e7.js"><link rel="prefetch" href="/web-bookmarks/assets/js/19.647e5f6d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/20.9717638d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/21.0cac5171.js"><link rel="prefetch" href="/web-bookmarks/assets/js/22.c70cc195.js"><link rel="prefetch" href="/web-bookmarks/assets/js/23.d9003184.js"><link rel="prefetch" href="/web-bookmarks/assets/js/24.211511f5.js"><link rel="prefetch" href="/web-bookmarks/assets/js/25.04e1b069.js"><link rel="prefetch" href="/web-bookmarks/assets/js/26.2d270406.js"><link rel="prefetch" href="/web-bookmarks/assets/js/27.e7533300.js"><link rel="prefetch" href="/web-bookmarks/assets/js/28.3aed94f9.js"><link rel="prefetch" href="/web-bookmarks/assets/js/29.92e273be.js"><link rel="prefetch" href="/web-bookmarks/assets/js/3.245bfa5f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/30.25d0a87b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/31.6faa7834.js"><link rel="prefetch" href="/web-bookmarks/assets/js/32.299ba881.js"><link rel="prefetch" href="/web-bookmarks/assets/js/33.41e708ec.js"><link rel="prefetch" href="/web-bookmarks/assets/js/34.43f2ea4c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/35.dba0c764.js"><link rel="prefetch" href="/web-bookmarks/assets/js/36.5890167a.js"><link rel="prefetch" href="/web-bookmarks/assets/js/37.9204a83c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/38.9c10d6c0.js"><link rel="prefetch" href="/web-bookmarks/assets/js/39.ee2d015e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/4.303619ef.js"><link rel="prefetch" href="/web-bookmarks/assets/js/40.12bc65b1.js"><link rel="prefetch" href="/web-bookmarks/assets/js/41.c692c85f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/42.d3c9563c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/43.75b7f0d0.js"><link rel="prefetch" href="/web-bookmarks/assets/js/44.4074bfab.js"><link rel="prefetch" href="/web-bookmarks/assets/js/45.47af80c6.js"><link rel="prefetch" href="/web-bookmarks/assets/js/46.45407a55.js"><link rel="prefetch" href="/web-bookmarks/assets/js/47.4d92bddc.js"><link rel="prefetch" href="/web-bookmarks/assets/js/48.4623def6.js"><link rel="prefetch" href="/web-bookmarks/assets/js/49.ee8d8a3f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/5.c3b159b5.js"><link rel="prefetch" href="/web-bookmarks/assets/js/50.9fd61421.js"><link rel="prefetch" href="/web-bookmarks/assets/js/51.29cd7135.js"><link rel="prefetch" href="/web-bookmarks/assets/js/52.f1fb6ea9.js"><link rel="prefetch" href="/web-bookmarks/assets/js/53.0e27457c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/54.8bfb07d1.js"><link rel="prefetch" href="/web-bookmarks/assets/js/55.9bc14cfd.js"><link rel="prefetch" href="/web-bookmarks/assets/js/56.342a8ea7.js"><link rel="prefetch" href="/web-bookmarks/assets/js/57.412d5585.js"><link rel="prefetch" href="/web-bookmarks/assets/js/58.d329c30b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/59.109b57de.js"><link rel="prefetch" href="/web-bookmarks/assets/js/6.97f1d865.js"><link rel="prefetch" href="/web-bookmarks/assets/js/60.613d638c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/61.a17f4122.js"><link rel="prefetch" href="/web-bookmarks/assets/js/62.21fa7b30.js"><link rel="prefetch" href="/web-bookmarks/assets/js/63.23ef9c2a.js"><link rel="prefetch" href="/web-bookmarks/assets/js/64.054f05b7.js"><link rel="prefetch" href="/web-bookmarks/assets/js/65.daa9cb0e.js"><link rel="prefetch" href="/web-bookmarks/assets/js/66.6ad3eba9.js"><link rel="prefetch" href="/web-bookmarks/assets/js/67.2b5864a8.js"><link rel="prefetch" href="/web-bookmarks/assets/js/68.4fa92fee.js"><link rel="prefetch" href="/web-bookmarks/assets/js/69.01d0267f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/7.292d0198.js"><link rel="prefetch" href="/web-bookmarks/assets/js/70.aaa34d7d.js"><link rel="prefetch" href="/web-bookmarks/assets/js/71.7a2d0ad2.js"><link rel="prefetch" href="/web-bookmarks/assets/js/72.3fa46e21.js"><link rel="prefetch" href="/web-bookmarks/assets/js/73.2522884b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/74.1fb3f457.js"><link rel="prefetch" href="/web-bookmarks/assets/js/75.ea873445.js"><link rel="prefetch" href="/web-bookmarks/assets/js/76.a46f6d49.js"><link rel="prefetch" href="/web-bookmarks/assets/js/77.d44b7435.js"><link rel="prefetch" href="/web-bookmarks/assets/js/78.92b74921.js"><link rel="prefetch" href="/web-bookmarks/assets/js/79.1f0edaf4.js"><link rel="prefetch" href="/web-bookmarks/assets/js/80.4f6f29fb.js"><link rel="prefetch" href="/web-bookmarks/assets/js/81.a0b9588f.js"><link rel="prefetch" href="/web-bookmarks/assets/js/82.6bd2a0e8.js"><link rel="prefetch" href="/web-bookmarks/assets/js/83.eb553514.js"><link rel="prefetch" href="/web-bookmarks/assets/js/84.577b332b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/85.f5deacda.js"><link rel="prefetch" href="/web-bookmarks/assets/js/86.f9fb89ab.js"><link rel="prefetch" href="/web-bookmarks/assets/js/87.12490f43.js"><link rel="prefetch" href="/web-bookmarks/assets/js/88.4a7671ad.js"><link rel="prefetch" href="/web-bookmarks/assets/js/89.ab4a7855.js"><link rel="prefetch" href="/web-bookmarks/assets/js/90.a761cf6a.js"><link rel="prefetch" href="/web-bookmarks/assets/js/91.3a490844.js"><link rel="prefetch" href="/web-bookmarks/assets/js/92.d228211b.js"><link rel="prefetch" href="/web-bookmarks/assets/js/93.de7b4637.js"><link rel="prefetch" href="/web-bookmarks/assets/js/94.3c654b79.js"><link rel="prefetch" href="/web-bookmarks/assets/js/95.654881bc.js"><link rel="prefetch" href="/web-bookmarks/assets/js/96.7525d03c.js"><link rel="prefetch" href="/web-bookmarks/assets/js/97.104767f6.js"><link rel="prefetch" href="/web-bookmarks/assets/js/98.b44ebfd8.js"><link rel="prefetch" href="/web-bookmarks/assets/js/99.b25ce506.js"><link rel="prefetch" href="/web-bookmarks/assets/js/vendors~docsearch.56a0f16e.js">
    <link rel="stylesheet" href="/web-bookmarks/assets/css/0.styles.be43791e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-bookmarks/" class="home-link router-link-active"><img src="/web-bookmarks/cute-spear-monster.jpg" alt="web-bookmarks" class="logo"> <span class="site-name can-hide">web-bookmarks</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/html/a1.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/css/a1.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/javascript/a1.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/color/a1.html" class="nav-link">
  Color
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/regx/a1.html" class="nav-link">
  正则
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/word-interpretation/a1.html" class="nav-link">
  名词释义
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/tool/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/site/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/other/" class="nav-link">
  其他综合
</a></li></ul></div></div><div class="nav-item"><a href="/web-bookmarks/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/web-bookmarks/rtsp2web/" class="nav-link">
  rtsp2web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="综合" class="dropdown-title"><span class="title">综合</span> <span class="arrow down"></span></button> <button type="button" aria-label="综合" class="mobile-dropdown-title"><span class="title">综合</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/tech/" class="nav-link">
  技术
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/docs/" class="nav-link">
  文档
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/notes/" class="nav-link router-link-active">
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/health/" class="nav-link">
  健康
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文字" class="dropdown-title"><span class="title">文字</span> <span class="arrow down"></span></button> <button type="button" aria-label="文字" class="mobile-dropdown-title"><span class="title">文字</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/book/" class="nav-link">
  书
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/foreign/" class="nav-link">
  外文
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/cognition/" class="nav-link">
  认知
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/music/" class="nav-link">
  音乐
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/video/" class="nav-link">
  视频
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/gard/" class="nav-link">
  圈子
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/kobe/" class="nav-link">
  KOBE
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/s/" class="nav-link">
  大S
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/culture/" class="nav-link">
  文化
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/another/" class="nav-link">
  其它
</a></li></ul></div></div> <a href="https://github.com/Neveryu/web-bookmarks" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/html/a1.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/css/a1.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/javascript/a1.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/color/a1.html" class="nav-link">
  Color
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/regx/a1.html" class="nav-link">
  正则
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/base/word-interpretation/a1.html" class="nav-link">
  名词释义
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><span class="title">收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="收藏" class="mobile-dropdown-title"><span class="title">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/tool/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/site/" class="nav-link">
  网站
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/favorite/other/" class="nav-link">
  其他综合
</a></li></ul></div></div><div class="nav-item"><a href="/web-bookmarks/interview/" class="nav-link">
  面试
</a></div><div class="nav-item"><a href="/web-bookmarks/rtsp2web/" class="nav-link">
  rtsp2web
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="综合" class="dropdown-title"><span class="title">综合</span> <span class="arrow down"></span></button> <button type="button" aria-label="综合" class="mobile-dropdown-title"><span class="title">综合</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/tech/" class="nav-link">
  技术
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/docs/" class="nav-link">
  文档
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/notes/" class="nav-link router-link-active">
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/summary/health/" class="nav-link">
  健康
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文字" class="dropdown-title"><span class="title">文字</span> <span class="arrow down"></span></button> <button type="button" aria-label="文字" class="mobile-dropdown-title"><span class="title">文字</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/book/" class="nav-link">
  书
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/foreign/" class="nav-link">
  外文
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/cognition/" class="nav-link">
  认知
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/music/" class="nav-link">
  音乐
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/video/" class="nav-link">
  视频
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/gard/" class="nav-link">
  圈子
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/kobe/" class="nav-link">
  KOBE
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/s/" class="nav-link">
  大S
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/culture/" class="nav-link">
  文化
</a></li><li class="dropdown-item"><!----> <a href="/web-bookmarks/other/another/" class="nav-link">
  其它
</a></li></ul></div></div> <a href="https://github.com/Neveryu/web-bookmarks" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-bookmarks/summary/notes/" aria-current="page" class="sidebar-link">笔记</a></li><li><a href="/web-bookmarks/summary/notes/a1.html" class="sidebar-link">algorithms（算法）</a></li><li><a href="/web-bookmarks/summary/notes/angular.html" class="sidebar-link">Angular 入门笔记（超棒）</a></li><li><a href="/web-bookmarks/summary/notes/angular1.html" aria-current="page" class="active sidebar-link">Angular 高阶内容笔记（超棒）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#十三、rxjs" class="sidebar-link">十三、RxJS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_13-1、概述" class="sidebar-link">13.1、概述</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_13-2、可观察对象" class="sidebar-link">13.2、可观察对象</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_13-3、辅助方法" class="sidebar-link">13.3、辅助方法</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_13-4、操作符" class="sidebar-link">13.4、操作符</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_13-5、练习" class="sidebar-link">13.5、练习</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#十四、httpclientmodule" class="sidebar-link">十四、HttpClientModule</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-1、快速开始" class="sidebar-link">14.1、快速开始</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-2、请求方法" class="sidebar-link">14.2、请求方法</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-3、请求参数" class="sidebar-link">14.3、请求参数</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-4、请求头" class="sidebar-link">14.4、请求头</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-5、响应内容" class="sidebar-link">14.5、响应内容</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-6、拦截器" class="sidebar-link">14.6、拦截器</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_14-7、angular-proxy" class="sidebar-link">14.7、Angular Proxy</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#十五、ngrx" class="sidebar-link">十五、NgRx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-1、概述" class="sidebar-link">15.1、概述</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-2、快速开始" class="sidebar-link">15.2、快速开始</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-3、action-payload" class="sidebar-link">15.3、Action Payload</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-4、metareducer" class="sidebar-link">15.4、MetaReducer</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-5、effect-副作用" class="sidebar-link">15.5、Effect（副作用）</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-6、entity" class="sidebar-link">15.6、Entity</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_15-7、router-store" class="sidebar-link">15.7、Router Store</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#十六、动画" class="sidebar-link">十六、动画</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-1、状态" class="sidebar-link">16.1、状态</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-2、快速上手" class="sidebar-link">16.2、快速上手</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-3、关键帧动画" class="sidebar-link">16.3、关键帧动画</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-4、动画回调" class="sidebar-link">16.4、动画回调</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-5、创建可重用动画" class="sidebar-link">16.5、创建可重用动画</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-6、查询元素执行动画" class="sidebar-link">16.6、查询元素执行动画</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-7、交错动画" class="sidebar-link">16.7、交错动画</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-8、自定义状态动画" class="sidebar-link">16.8、自定义状态动画</a></li><li class="sidebar-sub-header"><a href="/web-bookmarks/summary/notes/angular1.html#_16-9、路由动画" class="sidebar-link">16.9、路由动画</a></li></ul></li></ul></li><li><a href="/web-bookmarks/summary/notes/angular2.html" class="sidebar-link">Angular 实战中的总结与技术点剖析</a></li><li><a href="/web-bookmarks/summary/notes/html5shiv.html" class="sidebar-link">html5shiv</a></li><li><a href="/web-bookmarks/summary/notes/js1.html" class="sidebar-link">JavaScript基础笔记</a></li><li><a href="/web-bookmarks/summary/notes/mobile1.html" class="sidebar-link">移动端开发</a></li><li><a href="/web-bookmarks/summary/notes/node-base.html" class="sidebar-link">Node.js 基础</a></li><li><a href="/web-bookmarks/summary/notes/respond.html" class="sidebar-link">Respond.js</a></li><li><a href="/web-bookmarks/summary/notes/sass1.html" class="sidebar-link">sass、Compass 安装使用</a></li><li><a href="/web-bookmarks/summary/notes/three-first.html" class="sidebar-link">THREE 知识体系梳理</a></li><li><a href="/web-bookmarks/summary/notes/three1.html" class="sidebar-link">Three.js开发指南（第3版）</a></li><li><a href="/web-bookmarks/summary/notes/ts.html" class="sidebar-link">TypeScript</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="angular-高阶内容笔记-超棒"><a href="#angular-高阶内容笔记-超棒" class="header-anchor">#</a> Angular 高阶内容笔记（超棒）</h1> <h2 id="十三、rxjs"><a href="#十三、rxjs" class="header-anchor">#</a> 十三、RxJS</h2> <h3 id="_13-1、概述"><a href="#_13-1、概述" class="header-anchor">#</a> 13.1、概述</h3> <div class="custom-block tip"><p class="custom-block-title">官方文档</p> <p><a href="https://rxjs.dev/api" target="_blank" rel="noopener noreferrer">RxJS官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p><img src="/web-bookmarks/assets/img/rxjs-0.c4ccd5ed.png" alt=""></p> <h4 id="_13-1-1、什么是-rxjs"><a href="#_13-1-1、什么是-rxjs" class="header-anchor">#</a> 13.1.1、什么是 RxJS？</h4> <p>RxJS 是一个用于处理异步编程的 JavaScript 库，目标是使编写异步和基于回调的代码更容易。</p> <h4 id="_13-1-2、为什么要学习-rxjs"><a href="#_13-1-2、为什么要学习-rxjs" class="header-anchor">#</a> 13.1.2、为什么要学习 RxJS？</h4> <p>就像 Angular 深度集成 TypeScript 一样，Angular 也深度集成了 RxJS。</p> <p>服务、表单、事件、全局状态管理、异步请求 …</p> <h4 id="_13-1-3、快速入门"><a href="#_13-1-3、快速入门" class="header-anchor">#</a> 13.1.3、快速入门</h4> <ol><li>可观察对象 ( Observable ) ：类比 Promise 对象，内部可以用于执行异步代码，通过调用内部提供的方法将异步代码执行的结果传递到可观察对象外部。</li> <li>观察者 ( Observer )：类比 then 方法中的回调函数，用于接收可观察对象中传递出来数据。</li> <li>订阅 ( subscribe )：类比 then 方法，通过订阅将可观察对象和观察者连接起来，当可观察对象发出数据时，订阅者可以接收到数据。</li></ol> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVEAAABqCAYAAAAFvGKYAAAVsUlEQVR4Xu2dCbRW0/vHnzJHaaAytJQk0ookmZKkUNKEBpIKyVSmlJYhWZWVJEU0sVQLoYiIkFmlUBlC5hApGYsM//V51v/0e3u7973de88+797v++y17mq45+zznO93P9/z7GdPZf7777//xIohYAgYAoZAiRAoYyJaItzsJkPAEDAEFAETUWsIhoAhYAiUAgET0VKAZ7caAoaAIWAiam3AEDAEDIFSIGAiWgrw7FZDwBAwBExErQ0YAoaAIVAKBExESwGe3WoIGAKGgImotQFDwBAwBEqBgIloKcCzWw0BQ8AQKFREjzjiCEPHQwQWL17soVVmUkEIsBiwcePGBo5nCJQpU0beeuut2KwyEY0NymQqMhFNBuc4nmIiGgeK8deRuIia08ZPYklqjHoGxkdJ0MvOPZGIxu202Xmb8J/qio8iI1FzWj8aj4moHzwUxwpXTlscG+za/yHgig8T0UBaWQgiun79elm9erUcdNBBzlFduXKlVKpUSapUqSLffvut/PPPP1KjRg3nzy3OA1w5bXFssGtNRK0N/D8CIYjofffdJ7169ZIkdlesVq2aXHPNNXL11VfLueeeKwj47NmzvWovJqJe0aHtkoG+uNMrFon6xXOh1piIbgnNE088IXXq1JF69eqZiAbShrNtpolothnI8vOTFNHbb79dRo8eLT///LMccsghcsstt0iLFi3ks88+kw4dOsiMGTOkbt26isiECRNk7ty5MnPmTIki0ZtvvlnGjRsnFStWlD59+sgVV1yhX3/uv+iii2TBggWy5557SuvWrWX48OGy2267aV3Tpk2TyZMnywcffCDt2rWTyy+/XOrXry+DBw+Wf//9V1566SVZt26dPgebunTpogLKD3XXqlVLEFfSCfy+VatWWu9ff/0lw4YNkwcffFAj1pNOOklGjRol1atXd8qqK6d1anQOV+6KD4tEA2k0SYnoG2+8Iccee6xcf/31cvjhh8s999wjzz77rPzyyy/y9ddfq6i+++67cuihhypyCOb06dPlo48+2iyiVatWleuuu04YlEQYEb3zzjtPRe3777/X3/34449y6aWXypAhQ+SGG26Qp556Stq2basi3alTJxkzZozmOZnP16NHD60Hu/bee28VeGxL7c5PnTpVGjRoIJdddpkKMUK9YsUKFft+/frJnXfeKddee63stddeKqh77LGHLFu2TLbbbjtnLcCV0zozOMcrdsWHiWggDScpEUWsunfvLsuXL9cokEGbWbNmSefOneWHH37YJhFFENu0aaPIHnnkkSqGS5Ys0YEfItqJEyfKDjvsII888ojsvvvuKq78lCtXTh5//HG977333pMrr7xS7rrrLhVqIkwGrbiGkp4TRUTXrl0rlStX1giaKBjRHDBggA4+8fcRI0bovQgzdvFxiKJVF83AldO6sDUf6nTFh4loIK0nKRFFNBs2bKiCSRKeqLBbt24qgHSztyUSRcQqVKigyNIVJ/JDSOli33jjjVK+fHmtt2PHjiq2ZcuW1euHDh2qUWN6QdQ///xzee211zb/Kl1EiToXLVq0+feIJBExUW6TJk30XWrWrKm///vvv/XDMHbsWI2GXRVXTuvK3lyv1xUfJqKBtJykRBQ4EFIiO3Kfb7/9tooe0RtCiIjyfwgtha75Y489tkV3nusQRgrR36BBg/Re/m/OnDkagZJD/fXXX+Xiiy/Wrvb2228v48eP15xpQSLKtVGUWlAkmj46T4RJnXT5TzzxRP0Q7L///ltU3axZM82PuiqunNaVvblerys+TEQDaTlJiegrr7wiCxcuVPGhvPPOO5p/ZCDm9NNP1xFxrmnatKn+/qyzzpKlS5duIaJEjVHUR/d91apVmkdFLFu2bKn1bdy4US688EIVayLDAw88UAeaiA4jIW/evLl2/fkpSkTnz5+vOVvKhg0btNtPfrR///5Su3ZtFXO69BQEl+cweEUe1VVx5bSu7M31el3xYSIaSMtJUkSJ0CZNmqRdbUbEu3btqjlJRI1uN4M/t956qw7eMDKOAKYOLBH1IVrM26S7jHgiaNy/adMmHazaaaedNOpkgAkRZpSeqJbfER3yb3KWjLoz97QoEUWMmVXQvn17GTlypEa15GERbJ5LKuLuu++WRo0aaRefqPbTTz/VWQKuiiundWVvrtfrig8T0UBaTlIiChwDBw5UwUG4KERw5DPpHjOliWlLlH333Vej0+eff15F9P7779dpScccc4wKIAXxvO2222THHXfUqJbuO+JLQXyZdoTQET0ykISIUhiJZ0CJrjhCzeyA1O48OVryp0y2Z+Sf5xPx8kOZMmWK9OzZU/9OhNq7d2+ZN2+e/pv8KLnZaPDLVRNw5bSu7M31el3xYSIaSMtJUkSBhC424oNYIZ6phWhyzZo1Ot2osMLAFPM/o9H01Ov4HVOLGDVPL3TzGZhi4Ki4BSchn8u96TZT12+//aZpBKY3JVFcOW0StufiM1zxYSIaSGtJWkQDgcVrM105rdcv7bFxrvgwEfWY9FTTtkVEGQHnhzmYrBCykl0EXDltdt8q3Ke74sNENJA2kUlEI/F84IEHdECFQSDylVayi4Arp83uW4X7dFd8mIgG0iYKElHWk5O7ZN4lAzJMRifXyKAJyzatZBcBV06b3bcK9+mu+DARDaRNpIpoJJ5PPvmkTh9i3ibiyWAK04YYlY7WtgfyejlppiunzUmwEngpV3yYiCZAXhyPiESUDUKYUsQ8TcQzKpdccolOXmfakBU/EMBpmarFBy7Og9H8eLvwrDARDY+zWC1GRJm3ybQiJsC7Lrk+MIVDJVXgzkQ0KbQLf46JaPY5yKoFOCLzHPfbbz8VUXKhdOujEnXnc138skpCCR7OXqYsJjARLQF4Md9iIhozoKFVl5oTffHFF7U7nyqmUXeeDYnJjZqYZp9hnJbdpOI+jiL7bxamBSaiYfIWm9UFjc6zbycDS4gp05yITPv27Svnn3++Rj9WsouAK6fN7luF+3RXfNjAUiBtItM80UcffVTnh7766qsqpjfddJNNcfKAV1dO68GrBWmCKz5MRANpDtuyYonJ9swXZX9PjsGwkl0EXDltdt8q3Ke74sNENJA2sS0iGsir5I2Zrpw2bwCM+UVd8WEiGjNRrqozEXWFrLt6XTmtO4tzu2ZXfJiIBtJuTEQDISrFTFdOGx4Sfljsig8TUT/4LdIKE9EiIfLuAldO692LBmKQKz5MRANpACaigRBlkai3RJmIektNMoaZiCaDc5xPceW0cdqYT3W54sN5JMoE8C+++ELPwKlVq5bUrVt3i9U0LItbuXKlHme78847e8tpUXb++eefevCZq/cwEfW2aRRqmCunTX9grviYa4Zd8eFURN9//309ZIxzyqNStWpVPY6XA8Yon3zyie48xNriSChcg1mS+ouyk9MkOZOdo4FdbENnIloS1rJ7jyunTX2rXPIx12y54sOZiEai06lTJz2itl69esJ55A899JD+m1Mhx4wZYyK6jS3HRHQbgfLoMldOG71irvmYa+pc8eFMRFu1aiXffPONHpPLcbmpheN42TCDM8XZjYhIlGN52WSYc8g7duyox+zuuuuuehvniY8ePVpPgSTa4/jeFi1a6O84OZKoliN6OV2yS5cuKtKca84Ru9OmTdOzxWfOnKnH765evVpeeOEFKVu2rN7PM1kmyfpz6ufs89dff11ta9CggYwaNUrPQY8abGF2pkeimewqSWPJdxH9/ffflWfOsacNhFBcOW307iH6GH45bNgwPSp7/fr16lv4WPXq1eXLL7/UI7jPPvts/b/TTjtNJk+eHBvVrvhwIqLkaNiajSMqODs8vUSCxJpvhCraSHjAgAGaF+WeHj166DnmbELMxrbUxaYaLGtEMDmHfJdddpFGjRrJunXrhHs54nfkyJF61jkbc0AAm3GQpzzhhBOkfv36erY5IsnZ6BQE+48//pC5c+cKjfLDDz+UIUOGCIAj3tSJsENwJjtTRRQnz2RXSVpFvosovNCbWbp0qbaZEIorp+XdQ/Wxfv36qW8SjLA0GUHlCOtly5bp2Ai7kFEuuOACHUMZNGhQbFS74sOJiBLtARCC16dPn61AYJMMtmtDGLt3767ihAiyvRtl8ODBCu7atWvl6aef1muWL1+uIsi54rNmzZLOnTvLwoUL9WvFNaeeeurmqPWqq66Sn376SdeQI6ILFiyQJk2aqDAecMAB0q5dOxVIrqlcubJMnTpVzjjjDI1yOnToIG3atNG6SD107dpVn8lenpns5J2jnOiqVasy2lWxYsViN4xQRPSUU05RLOkFsPN+nTp1NG1z3HHHFdlz4D4+aBy0x4mlfNhwtqFDh2oe/eOPP9YPIu2Ea30vrpyW9w7Rx1q3bi1VqlRRTkeMGKH0MRbCdoEERuyVi4gSCEVjJnFy7IoPJyK6YcMGKVeunIbkRH7phR3aK1SoIPfee680b95cxQkQiQQpzz33nJx88smyaNEi2WeffaRhw4babW/cuLGQY+3WrZvUqFFD6wdsRDFKGSB4RJoMZvGDiNIVxB4K4oxTcx1dCgSabjz2kFp45plnlFieTRSMrUShjL5nspPUQySiHN+RyS7ep7glFBGtVq2acgWucIuz0G0jtUPJFKEjus2aNdNUTq9evdSh4JyP4bhx4xRTBJTeAx9D34srp+W9Q/SxFStWaDADpzVr1lT68DmCorFjx0rLli2Vc/wnStfFybErPpyIKC/O16V27doqVOmFUymbNm0qixcvVvFCnPg7DkaJuvBRBIngES3OmDFDhbF8+fIqdA8//LCebDlw4ECNbFML6YCXX35ZRRTwosI0JBwQG4YPHy6VKlXSuiET4WbDY9IHRx11lAoz16SKaGF2YlMkokRSmewqiQCEJKJHH320RqIUBJCoMcqPZ+o5EKEz4IhDtW3bVvPUOB5Holh3fms5Cc3H5s+fr+MSBEH0KFILH08CI0R0yZIlTvbDDU5E6YIxwJMOSCRWiOCaNWvkq6++UhFFyM4555zN0SJd+u+++067cHTb6c5RGKgiN0oUyoARU6hSc5zkVujek1PBkdNFlDroWkIWOdMoFUDkyVeS44ejruKECRM0HcGsgk2bNmW0k7xsJKLYkMkuujTFLSGJKGmR6MhmPoSIKvku+CgqQifyJ/dJSoQPMAOFFBPRrVtMaD7GYC2BFb0TuvQUeil8NOlNMuhkIprCM2LZvn17zYuR48CR6OYR2RHtvfnmmxrtRYNMCOns2bPV2Tj2l6g0yqvxlZo0aZLmKolOyFMS7SGGdAsOO+wwJYZoEKdDpIhCp0yZUqCITpw4UU/G5HryruTfWBBAIpuRf5LfCCH5PZwaB2agDBsLszN1YIkvaia7SnJ0R0giSn6bvDSFDyA8w+v06dOLjNDJU+NItBW69VE9JqJbi2hoPsYbkOLBV5ihg48TaOHn9BAJRExE03hmMIZuLcdYEFFSGADCyRgtp+BcDD6ceeaZGgVSCPmZmhRtLEx3HdARNApfMcSOLjxRKFEfXzkKQkuUysooRLR3795bdOe5BuFkRLB///46dSoqTHViwInnILB86bmGKBkhyGRnupNnsqu4USjX54KIkqYpKkLv2bOnpgD4GPKxw+EOPvjgzZGoq8UMJeGkqHtcdR9TnxuajzHbBZ+cN2+evgb5UTQCv2VVIyJKyq4k4wbZ4sNZTjT9heiaEyGmzxlNvQ7xYnllQd1dvroQQJSXnv+kDlIDDB5Fc0uLArSw3/McoiAEvLCIMZOd6fXGZVcuiCj550wR+pw5czQXygeUwSNmY9AWEF/y0uSS+UDSEwlh5/4kRDS1vYXiY9iM+G/cuFGDmaSKKz4SE9GkgMrV54QkovQUolkZUa452legsAidydakSujikaemcGbU8ccfr916Uiz0XrifnglpId+LK6f1/b19tc8VHyaivjKeZlcoIrqtcJY0QmcgglQLOWrfiyun9f29fbXPFR8mor4ynuMiGgjshZpJd5TCUuPCiiunDR27bNnvig8T0WwxWszn5lokWszX9+5yZp2wMIMUBIOlpCPSiyun9Q6MQAxyxYeJaCANwETUH6KIQpnVwQ+r4eCmb9++wrJGlhFHxZXT+oNEWJa44sNENJB2YCLqF1EsIhg/fryu72eDGmaMwBErrhBT8raunNYvJMKxxhUfJqKBtAETUb+IYhclpsOxaIQ5zKz3ZtALMWVOMSuz2OaN5c1MlWOFnpXsImAiml38s/50JiEzD5Dlp0mVkqysSsq20jwndS+F0tTDvZGY8mdUL3vVIqYIKHOb2R/CRLS0SJf+fhPR0mMYdA2swEJEo1VbQb9MnhiPiLJlHSLKxjVWsouAiWh28c/605mETiNg9ykr/iDAYgL2zWUZI2u/KSxlZM0/u4LRpbfuvB98mYj6wUPWrLCcaNagL/DB7E7G2n5WV7FVI915NsJhYIl14IzS061HUE1E/eDORNQPHrJmhYlo1qDf6sGkVO644w7drIYNvRFPdh5jr1Q2pY5WU7lyWn+QCMsSV3zY6Hwg7cBE1C+i2M6R7RjZ2QvxZGMcIs/UwThXTusXEuFY44oPE9FA2oCJqF9EEYHShY/W8Rc0k8GV0/qFRDjWuOLDRDSQNmAiGghRKWa6ctrwkPDDYld8mIj6wW+RVpiIFgmRdxe4clrvXjQQg1zxYSIaSAMwEQ2EKItEvSXKRNRbapIxzEQ0GZzjfIorp43TxnyqyxUfFokG0opMRAMhyiJRb4kyEfWWmmQMMxFNBuc4n+LKaeO0MZ/qcsWHRaKBtCIT0UCIskjUW6JMRL2lJhnDTESTwTnOp7hy2jhtzKe6XPFhkWggrchENBCiLBL1ligTUW+pScYwE9FkcI7zKa6cNk4b86kuV3xYJBpIKzIRDYQoi0S9JcpE1FtqkjHMRDQZnON8iiunjdPGfKrLFR8WiQbSikxEAyHKIlFviTIR9ZaaZAwzEU0G5zif4spp47Qxn+pyxYdFooG0IhPRQIiySNRborImot4ikqeG2YFn4RAfOW04FueHpXEf11JkJJofsIbzliai4XBlIuonV4mJqJ+vb1YZAoaAIeAXAoVGon6ZadYYAoaAIeAnAiaifvJiVhkChkAgCJiIBkKUmWkIGAJ+ImAi6icvZpUhYAgEgoCJaCBEmZmGgCHgJwImon7yYlYZAoZAIAiYiAZClJlpCBgCfiJgIuonL2aVIWAIBIKAiWggRJmZhoAh4CcCJqJ+8mJWGQKGQCAImIgGQpSZaQgYAn4iYCLqJy9mlSFgCASCgIloIESZmYaAIeAnAiaifvJiVhkChkAgCJiIBkKUmWkIGAJ+ImAi6icvZpUhYAgEgoCJaCBEmZmGgCHgJwImon7yYlYZAoZAIAj8H8sa1sJ03Nz9AAAAAElFTkSuQmCC" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 初体验（这段代码没看太明白，看视频的时候要学习）</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
  
<span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
</code></pre></div><h3 id="_13-2、可观察对象"><a href="#_13-2、可观察对象" class="header-anchor">#</a> 13.2、可观察对象</h3> <h4 id="_13-2-1、observable"><a href="#_13-2-1、observable" class="header-anchor">#</a> 13.2.1、Observable</h4> <ol><li>在 Observable 对象内部可以多次调用 next 方法向外发送数据。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>当所有数据发送完成以后，可以调用 complete 方法终止数据发送。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据发送完成&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>当 Observable 内部逻辑发生错误时，可以调用 error 方法将失败信息发送给订阅者，Observable 终止。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;发生错误&quot;</span><span class="token punctuation">)</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>可观察对象是惰性的，只有被订阅后才会执行</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello RxJS&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// observable.subscribe()</span>
</code></pre></div><ol start="5"><li>可观察对象可以有 n 多订阅者，每次被订阅时都会得到执行
<img src="/web-bookmarks/assets/img/rxjs-2.7adece5b.png" alt=""></li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello RxJS&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>取消订阅</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> obs <span class="token operator">=</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> subscription <span class="token operator">=</span> obs<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-2-2、subject"><a href="#_13-2-2、subject" class="header-anchor">#</a> 13.2.2、Subject</h4> <ol><li>用于创建空的可观察对象，在订阅后不会立即执行，next 方法可以在可观察对象外部调用</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> demoSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

demoSubject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
demoSubject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  demoSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;hahaha&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-2-3、behaviorsubject"><a href="#_13-2-3、behaviorsubject" class="header-anchor">#</a> 13.2.3、BehaviorSubject</h4> <p>拥有 Subject 全部功能，但是在创建 Obervable 对象时可以传入默认值，观察者订阅后可以直接拿到默认值。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BehaviorSubject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> demoBehavior <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token punctuation">(</span><span class="token string">&quot;默认值&quot;</span><span class="token punctuation">)</span>
demoBehavior<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
demoBehavior<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-2-4、replaysubject"><a href="#_13-2-4、replaysubject" class="header-anchor">#</a> 13.2.4、ReplaySubject</h4> <p>功能类似 Subject，但有新订阅者时两者处理方式不同，Subject 不会广播历史结果，而 ReplaySubject 会广播所有历史结果。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ReplaySubject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> rSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReplaySubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

rSubject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>value <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

rSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;Hello 1&quot;</span><span class="token punctuation">)</span>
rSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&quot;Hello 2&quot;</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rSubject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_13-3、辅助方法"><a href="#_13-3、辅助方法" class="header-anchor">#</a> 13.3、辅助方法</h3> <h4 id="_13-3-1、range"><a href="#_13-3-1、range" class="header-anchor">#</a> 13.3.1、range</h4> <p><code>range(start, length)</code>，调用方法后返回 observable 对象，被订阅后会发出指定范围的数值。
<img src="/web-bookmarks/assets/img/rxjs-3.0b88ee56.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 0</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
<span class="token comment">// 4</span>
</code></pre></div><p>方法内部并不是一次发出 length 个数值，而是发送了 length 次，每次发送一个数值，就是说内部调用了 length 次 next 方法。</p> <h4 id="_13-3-2、of"><a href="#_13-3-2、of" class="header-anchor">#</a> 13.3.2、of</h4> <p>将参数列表作为数据流返回。</p> <h4 id="_13-3-3、from"><a href="#_13-3-3、from" class="header-anchor">#</a> 13.3.3、from</h4> <p>将 Array，Promise, Iterator 转换为 observable 对象。
<img src="/web-bookmarks/assets/img/rxjs-4.c25c2c1a.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>
<span class="token comment">// c</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> from <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">function</span> <span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">from</span><span class="token punctuation">(</span><span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [100, 200]</span>
</code></pre></div><h4 id="_13-3-4、interval、timer"><a href="#_13-3-4、interval、timer" class="header-anchor">#</a> 13.3.4、interval、timer</h4> <p><strong>Interval：</strong> 每隔一段时间发出一个数值，数值递增
<img src="/web-bookmarks/assets/img/rxjs-5.9db8f2ba.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>timer：</strong> 间隔时间过去以后发出数值，行为终止，或间隔时间发出数值后，继续按第二个参数的时间间隔继续发出值
<img src="/web-bookmarks/assets/img/rxjs-6.39c76edd.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-5、concat"><a href="#_13-3-5、concat" class="header-anchor">#</a> 13.3.5、concat</h4> <p>合并数据流，先让第一个数据流发出值，结束后再让第二个数据流发出值，进行整体合并。
<img src="/web-bookmarks/assets/img/rxjs-7.b7638777.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> concat<span class="token punctuation">,</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-6、merge"><a href="#_13-3-6、merge" class="header-anchor">#</a> 13.3.6、merge</h4> <p>合并数据流，多个参数一起发出数据流，按照时间线进行交叉合并。
<img src="/web-bookmarks/assets/img/rxjs-8.f0e33edf.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> merge<span class="token punctuation">,</span> fromEvent<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> clicks <span class="token operator">=</span> <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token function">merge</span><span class="token punctuation">(</span>clicks<span class="token punctuation">,</span> timer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-7、combinelatest"><a href="#_13-3-7、combinelatest" class="header-anchor">#</a> 13.3.7、combineLatest</h4> <p>将两个 Obserable 中最新发出的数据流进行组合成新的数据流，以数组的形式发出。和当前最新的进行组合。
<img src="/web-bookmarks/assets/img/rxjs-9.d582faf8.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineLatest<span class="token punctuation">,</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> firstTimer <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// emit 0, 1, 2... after every second, starting from now</span>
<span class="token keyword">const</span> secondTimer <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// emit 0, 1, 2... after every second, starting 0,5s from now</span>
<span class="token function">combineLatest</span><span class="token punctuation">(</span>firstTimer<span class="token punctuation">,</span> secondTimer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token comment">// [0, 0] after 0.5s</span>
<span class="token comment">// [1, 0] after 1s</span>
<span class="token comment">// [1, 1] after 1.5s</span>
<span class="token comment">// [2, 1] after 2s</span>
</code></pre></div><h4 id="_13-3-8、zip"><a href="#_13-3-8、zip" class="header-anchor">#</a> 13.3.8、zip</h4> <p>将多个 Observable 中的数据流进行组合。和将来最新的进行组合。
<img src="/web-bookmarks/assets/img/rxjs-10.d026b653.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> zip<span class="token punctuation">,</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">&quot;Foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Beer&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> isDev <span class="token operator">=</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token function">zip</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> isDev<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> isDev<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> isDev <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token comment">// { name: 'Foo', age: 27, isDev: true }</span>
<span class="token comment">// { name: 'Bar', age: 25, isDev: true }</span>
<span class="token comment">// { name: 'Beer', age: 29, isDev: false }</span>
</code></pre></div><h4 id="_13-3-9、forkjoin"><a href="#_13-3-9、forkjoin" class="header-anchor">#</a> 13.3.9、forkJoin</h4> <p>forkJoin 是 Rx 版本的 Promise.all()，即表示等到所有的 Observable 都完成后，才一次性返回值。
<img src="/web-bookmarks/assets/img/rxjs-11.4f892f01.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> forkJoin<span class="token punctuation">,</span> from <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

<span class="token function">forkJoin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  goods<span class="token operator">:</span> <span class="token function">from</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3005/goods&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  category<span class="token operator">:</span> <span class="token function">from</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3005/category&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-10、throwerror"><a href="#_13-3-10、throwerror" class="header-anchor">#</a> 13.3.10、throwError</h4> <p>返回可观察对象并向订阅者抛出错误。
<img src="/web-bookmarks/assets/img/rxjs-12.59c89ca0.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> throwError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;发生了未知错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-11、retry"><a href="#_13-3-11、retry" class="header-anchor">#</a> 13.3.11、retry</h4> <p>如果 Observable 对象抛出错误，则该辅助方法会重新订阅 Observable 以获取数据流，参数为重新订阅次数。
<img src="/web-bookmarks/assets/img/rxjs-13.4e42e575.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval<span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token punctuation">,</span> throwError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap<span class="token punctuation">,</span> retry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span>val <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">&quot;Error!&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    next<span class="token operator">:</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">,</span>
    error<span class="token operator">:</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-12、race"><a href="#_13-3-12、race" class="header-anchor">#</a> 13.3.12、race</h4> <p>接收并同时执行多个可观察对象，只将最快发出的数据流传递给订阅者。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> race<span class="token punctuation">,</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">const</span> obs1 <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token string">&quot;fast one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> obs2 <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token string">&quot;medium one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> obs3 <span class="token operator">=</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token string">&quot;slow one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">race</span><span class="token punctuation">(</span>obs3<span class="token punctuation">,</span> obs1<span class="token punctuation">,</span> obs2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-3-13、fromevent"><a href="#_13-3-13、fromevent" class="header-anchor">#</a> 13.3.13、fromEvent</h4> <p>将事件转换为 Observable。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 可以将 Observer 简写成一个函数，表示 next</span>
<span class="token function">fromEvent</span><span class="token punctuation">(</span>btn<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_13-4、操作符"><a href="#_13-4、操作符" class="header-anchor">#</a> 13.4、操作符</h3> <ol><li>数据流：从可观察对象内部输出的数据就是数据流，可观察对象内部可以向外部源源不断的输出数据。</li> <li>操作符：用于操作数据流，可以对象数据流进行转换，过滤等等操作。</li></ol> <h4 id="_13-4-1、map、mapto"><a href="#_13-4-1、map、mapto" class="header-anchor">#</a> 13.4.1、map、mapTo</h4> <p><strong>map：</strong> 对数据流进行转换，基于原有值进行转换。
<img src="/web-bookmarks/assets/img/rxjs-14.0c66e337.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>mapTo：</strong> 对数据流进行转换，不关心原有值，可以直接传入要转换后的值。
<img src="/web-bookmarks/assets/img/rxjs-15.fec2eeb6.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> msg<span class="token operator">:</span> <span class="token string">&quot;接收到了数据流&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>msg <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-2、filter"><a href="#_13-4-2、filter" class="header-anchor">#</a> 13.4.2、filter</h4> <p>对数据流进行过滤。
<img src="/web-bookmarks/assets/img/rxjs-16.e1e8635b.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> filter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>even <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>even<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-3、pluck"><a href="#_13-4-3、pluck" class="header-anchor">#</a> 13.4.3、pluck</h4> <p>获取数据流对象中的属性值。
<img src="/web-bookmarks/assets/img/rxjs-17.823de1ee.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pluck<span class="token punctuation">,</span> mapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> <span class="token string">&quot;c&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-4、first"><a href="#_13-4-4、first" class="header-anchor">#</a> 13.4.4、first</h4> <p>获取数据流中的第一个值或者查找数据流中第一个符合条件的值，类似数组中的 find 方法。获取到值以后终止行为。
<img src="/web-bookmarks/assets/img/rxjs-18.047a649e.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> first <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">first</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-5、startwith"><a href="#_13-4-5、startwith" class="header-anchor">#</a> 13.4.5、startWith</h4> <p>创建一个新的 observable 对象并将参数值发送出去，然后再发送源 observable 对象发出的值。</p> <p>在异步编程中提供默认值的时候非常有用。
<img src="/web-bookmarks/assets/img/rxjs-19.bfc4ccf4.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> startWith <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">startWith</span><span class="token punctuation">(</span><span class="token number">505</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 505</span>
<span class="token comment">// 100</span>
<span class="token comment">// 101</span>
<span class="token comment">// 102</span>
<span class="token comment">// ...</span>
</code></pre></div><h4 id="_13-4-6、every"><a href="#_13-4-6、every" class="header-anchor">#</a> 13.4.6、every</h4> <p>查看数据流中的每个值是否都符合条件，返回布尔值。类似数组中的 every 方法。
<img src="/web-bookmarks/assets/img/rxjs-20.e15d55df.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> every<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">every</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>b <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-7、delay、delaywhen"><a href="#_13-4-7、delay、delaywhen" class="header-anchor">#</a> 13.4.7、delay、delayWhen</h4> <p><strong>delay：</strong> 对上一环节的操作整体进行延迟，只执行一次。
<img src="/web-bookmarks/assets/img/rxjs-21.3710770b.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> from <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> delay<span class="token punctuation">,</span> map<span class="token punctuation">,</span> tap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">tap</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;已经延迟 1s&quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;又延迟了 1s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token comment">// tap 操作符不会对数据流造成影响, 它被用来执行简单的副作用, 比如输出, 但是复杂的副作用不要在这执行, 比如 Ajax</span>
</code></pre></div><p><strong>delayWhen：</strong> 对上一环节的操作进行延迟，上一环节发出多少数据流，传入的回调函数就会执行多次。
<img src="/web-bookmarks/assets/img/rxjs-22.8df434ef.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range<span class="token punctuation">,</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> delayWhen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">delayWhen</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">timer</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-8、take、takewhile、takeutil"><a href="#_13-4-8、take、takewhile、takeutil" class="header-anchor">#</a> 13.4.8、take、takeWhile、takeUtil</h4> <p><strong>take：</strong> 获取数据流中的前几个
<img src="/web-bookmarks/assets/img/rxjs-23.e2630d47.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> take <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>takeWhile：</strong> 根据条件从数据源前面开始获取。
<img src="/web-bookmarks/assets/img/rxjs-24.35d21361.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> takeWhile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeWhile</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>takeUntil：</strong> 接收可观察对象，当可观察对象发出值时，终止主数据源。
<img src="/web-bookmarks/assets/img/rxjs-25.eeaede92.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval<span class="token punctuation">,</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> takeUntil <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token comment">// 结果少两个数据流的原因：第一次和最后一次，都需要延迟 100 毫秒。</span>
</code></pre></div><h4 id="_13-4-9、skip、skipwhile、skipuntil"><a href="#_13-4-9、skip、skipwhile、skipuntil" class="header-anchor">#</a> 13.4.9、skip、skipWhile、skipUntil</h4> <p><strong>skip：</strong> 跳过前几个数据流。
<img src="/web-bookmarks/assets/img/rxjs-26.76b3580a.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> skip <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>skipWhile：</strong> 根据条件进行数据流的跳过。
<img src="/web-bookmarks/assets/img/rxjs-27.d525abde.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> skipWhile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skipWhile</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>skipUntil：</strong> 跳过数据源中前多少时间发出的数据流，发送从这个时间以后数据源中发送的数据流。
<img src="/web-bookmarks/assets/img/rxjs-28.e1a46de5.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> timer<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> skipUntil <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skipUntil</span><span class="token punctuation">(</span><span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-10、last"><a href="#_13-4-10、last" class="header-anchor">#</a> 13.4.10、last</h4> <p>获取数据流中的最后一个。
<img src="/web-bookmarks/assets/img/rxjs-29.99304730.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> range <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> last <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p>如果数据源不变成完成状态，则没有最后一个。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> last<span class="token punctuation">,</span> take <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-11、concatall、concatmap"><a href="#_13-4-11、concatall、concatmap" class="header-anchor">#</a> 13.4.11、concatAll、concatMap</h4> <p><strong>concatAll：</strong> 有时 Observable 发出的又是一个 Obervable，concatAll 的作用就是将新的可观察对象和数据源进行合并。</p> <p>Observable =&gt; [1, 2, 3]</p> <p>Observable =&gt; [Observable, Observable]
<img src="/web-bookmarks/assets/img/rxjs-30.351b3042.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> take<span class="token punctuation">,</span> concatAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> concatAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span><span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>val <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span>val <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>concatMap：</strong> 合并可观察对象并处理其发出的数据流。
<img src="/web-bookmarks/assets/img/rxjs-31.51a21a74.png" alt=""></p> <h4 id="_13-4-13、reduce、scan"><a href="#_13-4-13、reduce、scan" class="header-anchor">#</a> 13.4.13、reduce、scan</h4> <p><strong>reduce:</strong> 类似 JavaScript 数组中的 reduce，对数数据进行累计操作。reduce 会等待数据源中的数据流发送完成后再执行，执行时 reduce 内部遍历每一个数据流进行累计操作，操作完成得到结果将结果作为数据流发出。
<img src="/web-bookmarks/assets/img/rxjs-32.80d2fa5a.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> take<span class="token punctuation">,</span> reduce <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc <span class="token operator">+=</span> value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-14、mergeall、mergemap"><a href="#_13-4-14、mergeall、mergemap" class="header-anchor">#</a> 13.4.14、mergeAll、mergeMap</h4> <p><strong>mergeAll：</strong> 交叉合并可观察对象。
<img src="/web-bookmarks/assets/img/rxjs-33.29c8da5f.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> mergeAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mergeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><strong>mergeMap：</strong> 交叉合并可观察对象以后对可观察对象发出的数据流进行转换。
<img src="/web-bookmarks/assets/img/rxjs-34.6ea568c9.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span><span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mergeMap</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> x <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-15、throttletime"><a href="#_13-4-15、throttletime" class="header-anchor">#</a> 13.4.15、throttleTime</h4> <p>节流，可观察对象高频次向外部发出数据流，通过 throttleTime 限制在规定时间内每次只向订阅者传递一次数据流。
<img src="/web-bookmarks/assets/img/rxjs-35.9871ac2d.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> throttleTime <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">throttleTime</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-16、debouncetime"><a href="#_13-4-16、debouncetime" class="header-anchor">#</a> 13.4.16、debounceTime</h4> <p>防抖，触发高频事件，只响应最后一次。
<img src="/web-bookmarks/assets/img/rxjs-36.50621989.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> debounceTime <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">debounceTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-17、distinctuntilchanged"><a href="#_13-4-17、distinctuntilchanged" class="header-anchor">#</a> 13.4.17、distinctUntilChanged</h4> <p>检测数据源当前发出的数据流是否和上次发出的相同，如相同，跳过，不相同，发出。
<img src="/web-bookmarks/assets/img/rxjs-37.c4f47a5a.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> distinctUntilChanged <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1, 2, 1, 2, 3, 4</span>
</code></pre></div><h4 id="_13-4-18、groupby"><a href="#_13-4-18、groupby" class="header-anchor">#</a> 13.4.18、groupBy</h4> <p>对数据流进行分组。
<img src="/web-bookmarks/assets/img/rxjs-38.52ae38dd.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap<span class="token punctuation">,</span> groupBy<span class="token punctuation">,</span> toArray <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">of</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Sue&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Joe&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Frank&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;Sarah&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">35</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">groupBy</span><span class="token punctuation">(</span>person <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mergeMap</span><span class="token punctuation">(</span>group <span class="token operator">=&gt;</span> group<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>

<span class="token comment">// [{name: &quot;Sue&quot;, age: 25}, { name: &quot;Frank&quot;, age: 25 }]</span>
<span class="token comment">// [{ name: &quot;Joe&quot;, age: 30 }]</span>
<span class="token comment">// [{ name: &quot;Sarah&quot;, age: 35 }]</span>
</code></pre></div><h4 id="_13-4-19、withlatestfrom"><a href="#_13-4-19、withlatestfrom" class="header-anchor">#</a> 13.4.19、withLatestFrom</h4> <p>主数据源发出的数据流总是和支数据源中的最新数据流进行结合，返回数组。
<img src="/web-bookmarks/assets/img/rxjs-39.5a558c9f.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> withLatestFrom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">const</span> clicks <span class="token operator">=</span> <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
clicks<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-4-20、switchmap"><a href="#_13-4-20、switchmap" class="header-anchor">#</a> 13.4.20、switchMap</h4> <p>切换可观察对象。
<img src="/web-bookmarks/assets/img/rxjs-40.f80aa69b.png" alt=""></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> interval <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> switchMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">switchMap</span><span class="token punctuation">(</span>ev <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_13-5、练习"><a href="#_13-5、练习" class="header-anchor">#</a> 13.5、练习</h3> <h4 id="_13-5-1、元素拖拽"><a href="#_13-5-1、元素拖拽" class="header-anchor">#</a> 13.5.1、元素拖拽</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">#box</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> skyblue<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 原生 JavaScript</span>
box<span class="token punctuation">.</span><span class="token function-variable function">onmousedown</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> distanceX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>offsetLeft
  <span class="token keyword">let</span> distanceY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>offsetTop
  document<span class="token punctuation">.</span><span class="token function-variable function">onmousemove</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> positionX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> distanceX
    <span class="token keyword">let</span> positionY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> distanceY
    box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> positionX <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span>
    box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> positionY <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span>
  <span class="token punctuation">}</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">onmouseup</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>onmousemove <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// RxJS</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> switchMap<span class="token punctuation">,</span> takeUntil <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">const</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;box&quot;</span><span class="token punctuation">)</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>box<span class="token punctuation">,</span> <span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      distanceX<span class="token operator">:</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">,</span>
      distanceY<span class="token operator">:</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>offsetTop
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> distanceX<span class="token punctuation">,</span> distanceY <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
          positionX<span class="token operator">:</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> distanceX<span class="token punctuation">,</span>
          positionY<span class="token operator">:</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> distanceY
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> positionX<span class="token punctuation">,</span> positionY <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> positionX <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span>
    box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> positionY <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-5-2、搜索"><a href="#_13-5-2、搜索" class="header-anchor">#</a> 13.5.2、搜索</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>search<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入搜索内容...<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> from<span class="token punctuation">,</span> throwError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> debounceTime<span class="token punctuation">,</span> distinctUntilChanged<span class="token punctuation">,</span> map<span class="token punctuation">,</span> switchMap<span class="token punctuation">,</span> catchError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span>

<span class="token keyword">const</span> search <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;search&quot;</span><span class="token punctuation">)</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span> <span class="token string">&quot;keyup&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">debounceTime</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span>keyword <span class="token operator">=&gt;</span>
      <span class="token function">from</span><span class="token punctuation">(</span>
        axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://j1sonplaceholder.typicode.com/posts?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>keyword<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">map</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">发生了错误: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> value <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_13-5-3、串联请求"><a href="#_13-5-3、串联请求" class="header-anchor">#</a> 13.5.3、串联请求</h4> <p>先获取token，再根据token获取用户信息</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>获取用户信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> from<span class="token punctuation">,</span> fromEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pluck<span class="token punctuation">,</span> concatMap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn&quot;</span><span class="token punctuation">)</span>

<span class="token function">fromEvent</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">concatMap</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span>
      <span class="token function">from</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3005/token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">concatMap</span><span class="token punctuation">(</span>token <span class="token operator">=&gt;</span>
      <span class="token function">from</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3005/userInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h2 id="十四、httpclientmodule"><a href="#十四、httpclientmodule" class="header-anchor">#</a> 十四、HttpClientModule</h2> <p>该模块用于发送 Http 请求，用于发送请求的方法都返回 Observable 对象。</p> <h3 id="_14-1、快速开始"><a href="#_14-1、快速开始" class="header-anchor">#</a> 14.1、快速开始</h3> <ol><li>引入 HttpClientModule 模块</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// app.module.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> httpClientModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>
imports<span class="token operator">:</span> <span class="token punctuation">[</span>
  httpClientModule
<span class="token punctuation">]</span>
</code></pre></div><ol start="2"><li>注入 HttpClient 服务实例对象，用于发送请求</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// app.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token operator">:</span> HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>发送请求</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> http<span class="token operator">:</span> HttpClient<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_14-2、请求方法"><a href="#_14-2、请求方法" class="header-anchor">#</a> 14.2、请求方法</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>url <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Post<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'/getAllPosts'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_14-3、请求参数"><a href="#_14-3、请求参数" class="header-anchor">#</a> 14.3、请求参数</h3> <ol><li>HttpParams 类</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">class</span> <span class="token class-name">HttpParams</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> HttpParamsOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">has</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token function">get</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">getAll</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">append</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpParams<span class="token punctuation">;</span>
  <span class="token function">set</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpParams<span class="token punctuation">;</span>
  <span class="token keyword">delete</span><span class="token punctuation">(</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpParams<span class="token punctuation">;</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>HttpParamsOptions 接口</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">HttpParamsOptions</span> <span class="token punctuation">{</span>
    fromString<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    fromObject<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>param<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    encoder<span class="token operator">?</span><span class="token operator">:</span> HttpParameterCodec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>使用示例</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fromObject<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
params <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;sex&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;male&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fromString<span class="token operator">:</span> <span class="token string">&quot;name=zhangsan&amp;age=20&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_14-4、请求头"><a href="#_14-4、请求头" class="header-anchor">#</a> 14.4、请求头</h3> <p>请求头字段的创建需要使用 HttpHeaders 类，在类实例对象下面有各种操作请求头的方法。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">class</span> <span class="token class-name">HttpHeaders</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>headers<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">has</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token function">get</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">getAll</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">append</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpHeaders<span class="token punctuation">;</span>
    <span class="token function">set</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpHeaders<span class="token punctuation">;</span>
    <span class="token keyword">delete</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> HttpHeaders<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_14-5、响应内容"><a href="#_14-5、响应内容" class="header-anchor">#</a> 14.5、响应内容</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">HttpObserve</span> <span class="token operator">=</span> <span class="token string">'body'</span> <span class="token operator">|</span> <span class="token string">'response'</span><span class="token punctuation">;</span>
<span class="token comment">// response 读取完整响应体</span>
<span class="token comment">// body 读取服务器端返回的数据</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  <span class="token string">&quot;https://jsonplaceholder.typicode.com/users&quot;</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> observe<span class="token operator">:</span> <span class="token string">&quot;body&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><h3 id="_14-6、拦截器"><a href="#_14-6、拦截器" class="header-anchor">#</a> 14.6、拦截器</h3> <p>拦截器是 Angular 应用中全局捕获和修改 HTTP 请求和响应的方式。（Token、Error）</p> <p>拦截器将只拦截使用 HttpClientModule 模块发出的请求。</p> <p><code>ng g interceptor &lt;name&gt;</code> <img src="/web-bookmarks/assets/img/httpclient-1.26b62a8b.png" alt=""> <img src="/web-bookmarks/assets/img/httpclient-2.a2ff7599.png" alt=""></p> <h4 id="_14-6-1、请求拦截"><a href="#_14-6-1、请求拦截" class="header-anchor">#</a> 14.6.1、请求拦截</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 拦截方法</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>
    <span class="token comment">// unknown 指定请求体 (body) 的类型</span>
    request<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    next<span class="token operator">:</span> HttpHandler
     <span class="token comment">// unknown 指定响应内容 (body) 的类型</span>
  <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>HttpEvent<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 克隆并修改请求头</span>
    <span class="token keyword">const</span> req <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      setHeaders<span class="token operator">:</span> <span class="token punctuation">{</span>
        Authorization<span class="token operator">:</span> <span class="token string">&quot;Bearer xxxxxxx&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 通过回调函数将修改后的请求头回传给应用</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_14-6-2、响应拦截"><a href="#_14-6-2、响应拦截" class="header-anchor">#</a> 14.6.2、响应拦截</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HttpInterceptor</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 拦截方法</span>
  <span class="token function">intercept</span><span class="token punctuation">(</span>
    request<span class="token operator">:</span> HttpRequest<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    next<span class="token operator">:</span> HttpHandler
  <span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> HttpErrorResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">throwError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_14-6-3、拦截注入"><a href="#_14-6-3、拦截注入" class="header-anchor">#</a> 14.6.3、拦截注入</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AuthInterceptor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./auth.interceptor&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HTTP_INTERCEPTORS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/common/http&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">HTTP_INTERCEPTORS</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> AuthInterceptor<span class="token punctuation">,</span>
      multi<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_14-7、angular-proxy"><a href="#_14-7、angular-proxy" class="header-anchor">#</a> 14.7、Angular Proxy</h3> <ol><li>在项目的根目录下创建 proxy.conf.json 文件并加入如下代码</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;/api/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:3070&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;secure&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;changeOrigin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><ol><li><code>/api/*</code>：在应用中发出的以 <code>/api</code> 开头的请求走此代理</li></ol></li> <li><ol start="2"><li>target：服务器端 URL</li></ol></li> <li><ol start="3"><li>secure：如果服务器端 URL 的协议是 https，此项需要为 true</li></ol></li> <li><ol start="4"><li>changeOrigin：如果服务器端不是 localhost， 此项需要为 true</li></ol></li></ul> <ol start="2"><li>指定 proxy 配置文件 (方式一)</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ng serve --proxy-config proxy.conf.json&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>指定 proxy 配置文件 (方式二)</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;proxyConfig&quot;</span><span class="token operator">:</span> <span class="token string">&quot;proxy.conf.json&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="十五、ngrx"><a href="#十五、ngrx" class="header-anchor">#</a> 十五、NgRx</h2> <h3 id="_15-1、概述"><a href="#_15-1、概述" class="header-anchor">#</a> 15.1、概述</h3> <p>NgRx 是 Angular 应用中实现全局状态管理的 Redux 架构解决方案。
<img src="/web-bookmarks/assets/img/ngrx-0.e793a095.png" alt=""></p> <ol><li>@ngrx/store：全局状态管理模块</li> <li>@ngrx/effects：处理副作用</li> <li>@ngrx/store-devtools：浏览器调试工具，需要依赖 Redux Devtools Extension</li> <li>@ngrx/schematics：命令行工具，快速生成 NgRx 文件</li> <li>@ngrx/entity：提高开发者在 Reducer 中操作数据的效率</li> <li>@ngrx/router-store：将路由状态同步到全局 Store</li></ol> <h3 id="_15-2、快速开始"><a href="#_15-2、快速开始" class="header-anchor">#</a> 15.2、快速开始</h3> <ol><li>下载 NgRx</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @ngrx/store @ngrx/effects @ngrx/entity @ngrx/router-store @ngrx/store-devtools @ngrx/schematics
</code></pre></div><ol start="2"><li>配置 NgRx CLI</li></ol> <p>默认情况下，Angular 的 CLI 工具是没有 <code>NgRx</code> 相关的命令的。配置了 <code>NgRx CLI</code> 工具以后，<code>NgRx</code> 的相关命令就可以使用了。就可以使用命令来创建 Store、Action、Reducer 之类等等。配置方法如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ng config cli.defaultCollection @ngrx/schematics
</code></pre></div><p>// or 在配置文件中自己手动配置</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// angular.json</span>
<span class="token property">&quot;cli&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;defaultCollection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@ngrx/schematics&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>创建 Store</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>ng g store State <span class="token parameter variable">--root</span> <span class="token parameter variable">--module</span> app.module.ts <span class="token parameter variable">--statePath</span> store <span class="token parameter variable">--stateInterface</span> AppState
</code></pre></div><ol start="4"><li>创建 Action</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>ng g action store/actions/counter <span class="token parameter variable">--skipTests</span>
</code></pre></div><p><em><code>--skipTexts</code> 忽略测试文件（不创建测试文件）</em></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;increment&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> decrement <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;decrement&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>创建 Reducer</li></ol> <div class="language- extra-class"><pre class="language-text"><code>ng g reducer store/reducers/counter --skipTests --reducers=../index.ts
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createReducer<span class="token punctuation">,</span> on <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> decrement<span class="token punctuation">,</span> increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../actions/counter.actions&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> counterFeatureKey <span class="token operator">=</span> <span class="token string">&quot;counter&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>increment<span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>decrement<span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><ol start="6"><li>创建 Selector
用来从 Store 中获取数据的。为了把复杂的获取数据的过程从组件代码当中抽离出来。组件就可以从 Selector 当中获取想要的数据。（简化组件获取数据的流程）</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>ng g selector store/selectors/counter <span class="token parameter variable">--skipTests</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// createFeatureSelector获取最外层的那个状态，createSelector是获取里层状态。</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createFeatureSelector<span class="token punctuation">,</span> createSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> counterFeatureKey<span class="token punctuation">,</span> State <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../reducers/counter.reducer&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;..&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> selectCounter <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>AppState<span class="token punctuation">,</span> State<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>counterFeatureKey<span class="token punctuation">)</span>
<span class="token comment">// 先获取到selectCounter，才能获取里面的count。</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectCount <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectCounter<span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>组件类触发 Action、获取状态</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> decrement<span class="token punctuation">,</span> increment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store/actions/counter.actions&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> selectCount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store/selectors/counter.selectors&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  count<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectCount<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li>组件模板显示状态</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>increment()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ count | async }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrement()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em><code>count</code> 是一个 Observable 类型数据， 通过 <code>async</code> 管道修饰符解析后才能读取 <code>count</code> 数据。</em></p> <h3 id="_15-3、action-payload"><a href="#_15-3、action-payload" class="header-anchor">#</a> 15.3、Action Payload</h3> <blockquote><p>如何在触发 action 的时候传递参数</p></blockquote> <ol><li>在组件中使用 dispatch 触发 Action 时传递参数，参数最终会被放置在 Action 对象中。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>在创建 Action Creator 函数时，获取参数并指定参数类型。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createAction<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token comment">// 第二个参数是props方法的调用</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;increment&quot;</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 为什么props方法的调用要传入object类型，因为源码中是这样定义的：</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token keyword">extends</span> object<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Props<span class="token operator">&lt;</span><span class="token constant">P</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>在 Reducer 中通过 Action 对象获取参数。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>increment<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> action<span class="token punctuation">.</span>count <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_15-4、metareducer"><a href="#_15-4、metareducer" class="header-anchor">#</a> 15.4、MetaReducer</h3> <p>metaReducer 是 Action -&gt; Reducer 之间的钩子，允许开发者对 Action 进行预处理 (在普通 Reducer 函数调用之前调用)。</p> <blockquote><p>metaReducer是redux中，中间件的概念。当执行action的时候，会先执行metaReducer再执行reducer。
虽然metaReducer是钩子函数，但它的名字是随意的。</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">debug</span><span class="token punctuation">(</span>reducer<span class="token operator">:</span> ActionReducer<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> ActionReducer<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> metaReducers<span class="token operator">:</span> MetaReducer<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>environment<span class="token punctuation">.</span>production
  <span class="token operator">?</span> <span class="token punctuation">[</span>debug<span class="token punctuation">]</span>
  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><p>第二个使用示例：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span>reducer<span class="token operator">:</span> ActionReducer<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> ActionReducer<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token comment">// reducer返回的值其实就是最新的内容</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上一次的状态: '</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'action: '</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'最新的状态: '</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> metaReducers<span class="token operator">:</span> MetaReducer<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span>environment<span class="token punctuation">.</span>production
  <span class="token operator">?</span> <span class="token punctuation">[</span>logger<span class="token punctuation">]</span>
  <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="_15-5、effect-副作用"><a href="#_15-5、effect-副作用" class="header-anchor">#</a> 15.5、Effect（副作用）</h3> <p>需求：在页面中新增一个按钮，点击按钮后延迟一秒让数值增加。</p> <ol><li>在组件模板中新增一个用于异步数值增加的按钮，按钮被点击后执行 increment_async 方法</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>increment_async()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>async<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>在组件类中新增 increment_async 方法，并在方法中触发执行异步操作的 Action</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">increment_async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment_async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>在 Action 文件中新增执行异步操作的 Action</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> increment_async <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">&quot;increment_async&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>创建 Effect，接收 Action 并执行副作用，继续触发 Action</li></ol> <div class="language- extra-class"><pre class="language-text"><code>ng g effect store/effects/counter --root --module app.module.ts --skipTests
</code></pre></div><p>Effect 功能由 @ngrx/effects 模块提供，所以在根模块中需要导入相关的模块依赖</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Actions<span class="token punctuation">,</span> createEffect<span class="token punctuation">,</span> ofType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/effects&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> increment_async <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../actions/counter.actions&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mergeMap<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs/operators&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> timer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;rxjs&quot;</span>

<span class="token comment">// createEffect</span>
<span class="token comment">// 用于创建 Effect, Effect 用于执行副作用.</span>
<span class="token comment">// 调用方法时传递回调函数, 回调函数中返回 Observable 对象, 对象中要发出副作用执行完成后要触发的 Action 对象</span>
<span class="token comment">// 回调函数的返回值在 createEffect 方法内部被继续返回, 最终返回值被存储在了 Effect 类的属性中</span>
<span class="token comment">// NgRx 在实例化 Effect 类后, 会订阅 Effect 类属性, 当副作用执行完成后它会获取到要触发的 Action 对象并触发这个 Action</span>

<span class="token comment">// Actions</span>
<span class="token comment">// 当组件触发 Action 时, Effect 需要通过 Actions 服务接收 Action, 所以在 Effect 类中通过 constructor 构造函数参数的方式将 Actions 服务类的实例对象注入到 Effect 类中</span>
<span class="token comment">// Actions 服务类的实例对象为 Observable 对象, 当有 Action 被触发时, Action 对象本身会作为数据流被发出</span>

<span class="token comment">// ofType</span>
<span class="token comment">// 对目标 Action 对象进行过滤，将你要操作的action过滤出来</span>
<span class="token comment">// 参数为目标 Action 的 Action Creator 函数</span>
<span class="token comment">// 如果未过滤出目标 Action 对象, 本次不会继续发送数据流</span>
<span class="token comment">// 如果过滤出目标 Action 对象, 会将 Action 对象作为数据流继续发出</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CounterEffects</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> actions<span class="token operator">:</span> Actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.loadCount.subscribe(console.log)</span>
  <span class="token punctuation">}</span>
  loadCount <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">ofType</span><span class="token punctuation">(</span>increment_async<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// mergeMap：合并Observable对象；</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_15-6、entity"><a href="#_15-6、entity" class="header-anchor">#</a> 15.6、Entity</h3> <h4 id="_15-6-1、概述"><a href="#_15-6-1、概述" class="header-anchor">#</a> 15.6.1、概述</h4> <p>Entity 译为实体（实体是面向对象当中的一个概念），实体就是集合中的一条数据。</p> <p>NgRx 中提供了实体适配器对象，在实体适配器对象下面提供了各种操作集合中实体的方法（增删改查），目的就是提高开发者操作实体的效率。</p> <p><em><font style="color:blue;">下面列举一个正常情况下使用 ngrx action 的例子： 输入框敲击回车键后，过滤输入框内容，把输入框内容调用 addTodo action 来执行。</font></em></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// app.component.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token keyword">implements</span> <span class="token class-name">AfterViewInit</span> <span class="token punctuation">{</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span><span class="token string">'AddTodoInput'</span><span class="token punctuation">)</span> AddTodoInput<span class="token operator">!</span><span class="token operator">:</span> ElementRef
  todos<span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Todo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectTodos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 用于展示</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 输入框增加回车事件，添加一条数据</span>
    <span class="token generic-function"><span class="token function">fromEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>KeyboardEvent<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>AddTodoInput<span class="token punctuation">.</span>nativeElement<span class="token punctuation">,</span> <span class="token string">&quot;keyup&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">filter</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">map</span><span class="token punctuation">(</span>event <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">map</span><span class="token punctuation">(</span>title <span class="token operator">=&gt;</span> title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">filter</span><span class="token punctuation">(</span>title <span class="token operator">=&gt;</span> title <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>title <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>AddTodoInput<span class="token punctuation">.</span>nativeElement<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">deleteTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">deleteTodo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let todo of todos | async<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group-item d-flex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ todo.title }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-danger<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteTodo(todo.id)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em><font style="color:blue;">下面我们来加入Entity简化实体操作</font></em></p> <h4 id="_15-6-2、核心"><a href="#_15-6-2、核心" class="header-anchor">#</a> 15.6.2、核心</h4> <ol><li>EntityState：实体类型接口</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">/*
  {
    ids: [1, 2],
    entities: {
      1: { id: 1, title: &quot;Hello Angular&quot; },
      2: { id: 2, title: &quot;Hello NgRx&quot; }
    }
  }
*/</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token keyword">extends</span> <span class="token class-name">EntityState<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>存储数据的格式要符合要求：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  ids<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token punctuation">,</span>
  entities<span class="token operator">:</span> Object
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>createEntityAdapter： 创建实体适配器对象。（使用 <code>createEntityAdapter</code> 来创建实体适配器对象）</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>EntityAdapter：实体适配器对象类型接口</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 获取初始状态，可以传递对象参数，也可以不传</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> State <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 会返回一个类似这样格式的对象</span>
<span class="token comment">// {ids: [], entities: {}}</span>
</code></pre></div><p>完整代码：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// todo.reducer.ts</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义数据类型由原来的</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  todos<span class="token operator">:</span> Todo<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 改为实体接口类型</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token keyword">extends</span> <span class="token class-name">EntityState<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 创建实体</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Todo<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 初始化数据由原来的</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 改为</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> State <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 添加/删除数据代码由原来的</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>addTodo<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>state<span class="token punctuation">,</span>
    todos<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> action<span class="token punctuation">.</span>title
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>deleteTodo<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newState<span class="token operator">:</span> State <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> newState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>todo <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    newState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> newState
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// 改为：</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>addTodo<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    adapter<span class="token punctuation">.</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token operator">:</span> action<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token comment">// addOne第一个参数是添加的数据，第二个参数是往哪添加</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>deleteTodo<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> adapter<span class="token punctuation">.</span><span class="token function">removeOne</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>id<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// removeOne第一个参数是要删除的数据id，第二个参数是从哪里面删除</span>
<span class="token punctuation">)</span>
</code></pre></div><h4 id="_15-6-3、实例方法"><a href="#_15-6-3、实例方法" class="header-anchor">#</a> 15.6.3、实例方法</h4> <p>adapter 有哪些方法：</p> <p><a href="https://ngrx.io/guide/entity/adapter#adapter-collection-methods" target="_blank" rel="noopener noreferrer">https://ngrx.io/guide/entity/adapter#adapter-collection-methods<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_15-6-4、选择器"><a href="#_15-6-4、选择器" class="header-anchor">#</a> 15.6.4、选择器</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// selectTotal 获取数据条数</span>
<span class="token comment">// selectAll 获取所有数据 以数组形式呈现</span>
<span class="token comment">// selectEntities 获取实体集合 以字典形式呈现</span>
<span class="token comment">// selectIds 获取id集合, 以数组形式呈现</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> selectIds<span class="token punctuation">,</span> selectEntities<span class="token punctuation">,</span> selectAll<span class="token punctuation">,</span> selectTotal <span class="token punctuation">}</span> <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> selectTodo <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>AppState<span class="token punctuation">,</span> State<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>todoFeatureKey<span class="token punctuation">)</span>

<span class="token comment">// 由原来的</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectTodo<span class="token punctuation">,</span> state <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
<span class="token comment">// 改为</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectTodo<span class="token punctuation">,</span> selectAll<span class="token punctuation">)</span>

<span class="token comment">// 其他可扩展的更多写法还有如下，看你自己的需求</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectTodo<span class="token punctuation">,</span> selectIds<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectTodo<span class="token punctuation">,</span> selectEntities<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodos <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectTodo<span class="token punctuation">,</span> selectTotal<span class="token punctuation">)</span>
</code></pre></div><h3 id="_15-7、router-store"><a href="#_15-7、router-store" class="header-anchor">#</a> 15.7、Router Store</h3> <h4 id="_15-7-1、同步路由状态"><a href="#_15-7-1、同步路由状态" class="header-anchor">#</a> 15.7.1、同步路由状态</h4> <ol><li>引入模块</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> StoreRouterConnectingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/router-store&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    StoreRouterConnectingModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>将路由状态集成到 Store</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromRouter <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/router-store&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  router<span class="token operator">:</span> fromRouter<span class="token punctuation">.</span>RouterReducerState
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> reducers<span class="token operator">:</span> ActionReducerMap<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  router<span class="token operator">:</span> fromRouter<span class="token punctuation">.</span>routerReducer
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_15-7-2、创建获取路由状态的-selector"><a href="#_15-7-2、创建获取路由状态的-selector" class="header-anchor">#</a> 15.7.2、创建获取路由状态的 Selector</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// router.selectors.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createFeatureSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;..&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RouterReducerState<span class="token punctuation">,</span> getSelectors <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/router-store&quot;</span>

<span class="token comment">// 创建获取路由状态的 Selector</span>
<span class="token keyword">const</span> selectRouter <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>AppState<span class="token punctuation">,</span> RouterReducerState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  <span class="token string">&quot;router&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取和当前路由相关的信息 (路由参数、路由配置等)</span>
  selectCurrentRoute<span class="token punctuation">,</span>
  <span class="token comment">// 获取地址栏中 # 号后面的内容</span>
  selectFragment<span class="token punctuation">,</span>
  <span class="token comment">// 获取路由查询参数</span>
  selectQueryParams<span class="token punctuation">,</span>
  <span class="token comment">// 获取具体的某一个查询参数 selectQueryParam('name')</span>
  selectQueryParam<span class="token punctuation">,</span>
  <span class="token comment">// 获取动态路由参数</span>
  selectRouteParams<span class="token punctuation">,</span>
  <span class="token comment">// 获取某一个具体的动态路由参数 selectRouteParam('name')</span>
  selectRouteParam<span class="token punctuation">,</span>
  <span class="token comment">// 获取路由自定义数据</span>
  selectRouteData<span class="token punctuation">,</span>
  <span class="token comment">// 获取路由的实际访问地址</span>
  selectUrl
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>selectRouter<span class="token punctuation">)</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// home.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> select<span class="token punctuation">,</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;src/app/store&quot;</span>
<span class="token comment">// 调用router.selectors.ts中导出的功能/方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> selectQueryParams<span class="token punctuation">,</span> selectCurrentRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;src/app/store/selectors/router.selectors&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AboutComponent</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectCurrentRoute<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token comment">// 会打印出当前route的数据信息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>selectQueryParams<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span> <span class="token comment">// 会打印出路由查询参数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="十六、动画"><a href="#十六、动画" class="header-anchor">#</a> 十六、动画</h2> <p><img src="/web-bookmarks/assets/img/animation-1.a5450a77.gif" alt=""></p> <p>在实现动画之前，我们需要先来了解一个概念：<font style="color:red;">状态。</font></p> <h3 id="_16-1、状态"><a href="#_16-1、状态" class="header-anchor">#</a> 16.1、状态</h3> <h4 id="_16-1-1、什么是状态"><a href="#_16-1-1、什么是状态" class="header-anchor">#</a> 16.1.1、什么是状态</h4> <p>状态表示的是要进行运动的元素在运动的不同时期所呈现的样式。
<img src="/web-bookmarks/assets/img/animation-2.9bb9863e.png" alt=""></p> <h4 id="_16-1-2、状态的种类"><a href="#_16-1-2、状态的种类" class="header-anchor">#</a> 16.1.2、状态的种类</h4> <p>在 Angular 中，有三种类型的状态，分别为：<code>void</code>、 <code>*</code>、 <code>custom</code> <img src="/web-bookmarks/assets/img/animation-3.d48c85f9.png" alt=""></p> <p><code>void</code>：当元素在内存中创建好但尚未被添加到 DOM 中或将元素从 DOM 中删除时会发生此状态。</p> <p><code>*</code>：元素被插入到 DOM 树之后的状态，或者是已经在DOM树中的元素的状态，也叫默认状态。</p> <p><code>custom</code>：自定义状态，元素默认就在页面之中，从一个状态运动到另一个状态，比如面板的折叠和展开。</p> <h4 id="_16-1-3、进出场动画"><a href="#_16-1-3、进出场动画" class="header-anchor">#</a> 16.1.3、进出场动画</h4> <p>进场动画是指元素被创建后以动画的形式出现在用户面前，进场动画的状态用 <code>void =&gt; *</code> 表示，别名为 <code>:enter</code> <img src="/web-bookmarks/assets/img/animation-4.5439d649.png" alt=""></p> <p>出场动画是指元素在被删除前执行的一段告别动画，出场动画的状态用 <code>* =&gt; void</code>，别名为 <code>:leave</code> <img src="/web-bookmarks/assets/img/animation-5.67055913.png" alt=""></p> <h3 id="_16-2、快速上手"><a href="#_16-2、快速上手" class="header-anchor">#</a> 16.2、快速上手</h3> <ol><li>在使用动画功能之前，需要引入动画模块，即 BrowserAnimationsModule</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserAnimationsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/platform-browser/animations&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>BrowserAnimationsModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>默认代码解析，todo 之[删除任务] 和 [添加任务]</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 在 index.html 文件中引入 bootstrap.min.css --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Todos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">(keyup.enter)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>addItem(input)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">#input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add todos<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removeItem(i)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of todos; let i = index<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      {{ item }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;app-root&quot;</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">&quot;./app.component.html&quot;</span><span class="token punctuation">,</span>
  styles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  <span class="token comment">// todo 列表</span>
  todos<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Learn Angular&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Learn RxJS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Learn NgRx&quot;</span><span class="token punctuation">]</span>
  <span class="token comment">// 添加 todo</span>
  <span class="token function">addItem</span><span class="token punctuation">(</span>input<span class="token operator">:</span> HTMLInputElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 删除 todo</span>
  <span class="token function">removeItem</span><span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ol start="3"><li><p>创建动画</p> <ol><li>trigger 方法用于创建动画，指定动画名称。</li> <li>transition 方法用于指定动画的运动状态，出场动画或者入场动画，或者自定义状态动画。</li> <li>style 方法用于设置元素在不同的状态下所对应的样式。</li> <li>animate 方法用于设置运动参数，比如动画运动时间，延迟事件，运动形式。</li></ol></li></ol> <p>在哪里定义动画呢，在组件的 <code>@Component</code> 装饰器中，有一个属性叫做 animations。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  animations<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 创建动画, 动画名称为 slide</span>
    <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;slide&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token comment">// 指定入场动画 注意: 字符串两边不能有空格, 箭头两边可以有也可以没有空格</span>
      <span class="token comment">// void =&gt; * 可以替换为 :enter</span>
      <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;void =&gt; *&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token comment">// 指定元素未入场前的样式</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(40px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 指定元素入场后的样式及运动参数</span>
        <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(0)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定出场动画</span>
      <span class="token comment">// * =&gt; void 可以替换为 :leave</span>
      <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;* =&gt; void&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token comment">// 指定元素出场后的样式和运动参数</span>
        <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：入场动画中可以不指定元素的默认状态，Angular 会将 void 状态清空作为默认状态</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;slide&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(40px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>注意：要设置动画的运动参数，需要将 animate 方法的第一个参数更改为字符串类型</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 参数顺序： 动画执行总时间 延迟时间 (可选) 运动形式 (可选)</span>
<span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">&quot;600ms 1s ease-out&quot;</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_16-3、关键帧动画"><a href="#_16-3、关键帧动画" class="header-anchor">#</a> 16.3、关键帧动画</h3> <p>关键帧动画使用 keyframes 方法定义</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">animate</span><span class="token punctuation">(</span>
    <span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token function">keyframes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(-80px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 帧位置offset取值范围：0.1 - 1</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_16-4、动画回调"><a href="#_16-4、动画回调" class="header-anchor">#</a> 16.4、动画回调</h3> <p>Angular 提供了和动画相关的两个回调函数，分别为【动画开始执行时的回调函数】和【动画执行完成后的回调函数】</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">@slide</span> <span class="token attr-name">(@slide.start)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>start($event)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(@slide.done)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>done($event)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AnimationEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/animations&quot;</span>

<span class="token function">start</span><span class="token punctuation">(</span>event<span class="token operator">:</span> AnimationEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">done</span><span class="token punctuation">(</span>event<span class="token operator">:</span> AnimationEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_16-5、创建可重用动画"><a href="#_16-5、创建可重用动画" class="header-anchor">#</a> 16.5、创建可重用动画</h3> <p>如果只在当前组件的 <code>@Component</code> 中定义动画，这个动画只有当前组件可以调用；如果想在其他组件中也调用这个动画，该怎么做呢？</p> <ol><li>将动画的定义放置在单独的文件中，方便多组件调用。</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> animate<span class="token punctuation">,</span> keyframes<span class="token punctuation">,</span> style<span class="token punctuation">,</span> transition<span class="token punctuation">,</span> trigger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/animations&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> slide <span class="token operator">=</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;slide&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(40px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">animate</span><span class="token punctuation">(</span>
      <span class="token number">600</span><span class="token punctuation">,</span>
      <span class="token function">keyframes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(-80px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> slide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./animations&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  animations<span class="token operator">:</span> <span class="token punctuation">[</span>slide<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>抽取具体的动画定义，方便多动画调用。</li></ol> <blockquote><p>使用 animation 方法来抽取动画的定义；使用 useAnimation 来调用 animation 定义的动画。</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>animate<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> keyframes<span class="token punctuation">,</span> style<span class="token punctuation">,</span> transition<span class="token punctuation">,</span> trigger<span class="token punctuation">,</span> useAnimation<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/animations&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> slideInUp <span class="token operator">=</span> <span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(40px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> slideOutLeft <span class="token operator">=</span> <span class="token function">animation</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">animate</span><span class="token punctuation">(</span>
    <span class="token number">600</span><span class="token punctuation">,</span>
    <span class="token function">keyframes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(-80px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> slide <span class="token operator">=</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;slide&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span>slideInUp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span>slideOutLeft<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div><ol start="3"><li>调用动画时传递运动总时间，延迟时间，运动形式</li></ol> <blockquote><p>之前的示例中的动画时间，延迟时间，运动形式都是写死的；可以使用参数 <code>params</code> 来定义默认值，并支持传入这些值。</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> slideInUp <span class="token operator">=</span> <span class="token function">animation</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>
    <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> opacity<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(40px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">&quot;{{ duration }} {{ delay }} {{ easing }}&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      duration<span class="token operator">:</span> <span class="token string">&quot;400ms&quot;</span><span class="token punctuation">,</span>
      delay<span class="token operator">:</span> <span class="token string">&quot;0s&quot;</span><span class="token punctuation">,</span>
      easing<span class="token operator">:</span> <span class="token string">&quot;ease-out&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token function">useAnimation</span><span class="token punctuation">(</span>slideInUp<span class="token punctuation">,</span> <span class="token punctuation">{</span>params<span class="token operator">:</span> <span class="token punctuation">{</span>delay<span class="token operator">:</span> <span class="token string">&quot;1s&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_16-6、查询元素执行动画"><a href="#_16-6、查询元素执行动画" class="header-anchor">#</a> 16.6、查询元素执行动画</h3> <p>Angular 中提供了 query 方法查找元素并为元素创建动画</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> slide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./animations&quot;</span>

animations<span class="token operator">:</span> <span class="token punctuation">[</span>
  slide<span class="token punctuation">,</span>
  <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;todoAnimations&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token comment">// query查询的是子元素，所以todoAnimations要放在h2的父元素上</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(-30px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 查询子级动画，使其执行，否则子级动画不会执行</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;@slide&quot;</span><span class="token punctuation">,</span> <span class="token function">animateChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@todoAnimations</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Todos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>
      <span class="token attr-name">@slide</span>
      <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removeItem(i)<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">*ngFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>let item of todos; let i = index<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-group-item<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
      {{ item }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>默认情况下，父级动画和子级动画按照顺序执行，先执行父级动画，再执行子级动画，可以使用 group(编组) 方法让其并行。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;todoAnimations&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(-30px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;@slide&quot;</span><span class="token punctuation">,</span> <span class="token function">animateChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_16-7、交错动画"><a href="#_16-7、交错动画" class="header-anchor">#</a> 16.7、交错动画</h3> <p>Angular 提供了 stagger 方法，在<strong>多个元素同时执行同一个动画</strong>时，让每个元素动画的执行依次延迟。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateY(-30px)&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">animate</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;@slide&quot;</span><span class="token punctuation">,</span> <span class="token function">stagger</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token function">animateChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>注意：stagger 方法只能在 query 方法内部使用。</p></blockquote> <h3 id="_16-8、自定义状态动画"><a href="#_16-8、自定义状态动画" class="header-anchor">#</a> 16.8、自定义状态动画</h3> <p>Angular 提供了 state 方法用于定义状态。
<img src="/web-bookmarks/assets/img/animation-6.ba230a6e.gif" alt=""></p> <ol><li>默认代码解析</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel panel-default<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel-heading<span class="token punctuation">&quot;</span></span> <span class="token attr-name">(click)</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toggle()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      一套框架, 多种平台, 移动端 &amp; 桌面端
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel-body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        使用简单的声明式模板，快速实现各种特性。使用自定义组件和大量现有组件，扩展模板语言。在几乎所有的
        IDE 中获得针对 Angular
        的即时帮助和反馈。所有这一切，都是为了帮助你编写漂亮的应用，而不是绞尽脑汁的让代码“能用”。
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        从原型到全球部署，Angular 都能带给你支撑 Google
        大型应用的那些高延展性基础设施与技术。
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        通过 Web Worker 和服务端渲染，达到在如今(以及未来）的 Web
        平台上所能达到的最高速度。 Angular 让你有效掌控可伸缩性。基于
        RxJS、Immutable.js 和其它推送模型，能适应海量数据需求。
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        学会用 Angular
        构建应用，然后把这些代码和能力复用在多种多种不同平台的应用上 ——
        Web、移动 Web、移动应用、原生应用和桌面原生应用。
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.container</span> <span class="token punctuation">{</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.panel-heading</span> <span class="token punctuation">{</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;app-root&quot;</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">&quot;./app.component.html&quot;</span><span class="token punctuation">,</span>
  styles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  isExpended<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isExpended <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isExpended
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>创建动画</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;expandCollapse&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token comment">// 使用 state 方法定义折叠状态元素对应的样式</span>
  <span class="token function">state</span><span class="token punctuation">(</span>
    <span class="token string">&quot;collapsed&quot;</span><span class="token punctuation">,</span>
    <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      height<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      overflow<span class="token operator">:</span> <span class="token string">&quot;hidden&quot;</span><span class="token punctuation">,</span>
      paddingTop<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      paddingBottom<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 使用 state 方法定义展开状态元素对应的样式</span>
  <span class="token function">state</span><span class="token punctuation">(</span><span class="token string">&quot;expanded&quot;</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> height<span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> overflow<span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 定义展开动画</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;collapsed =&gt; expanded&quot;</span><span class="token punctuation">,</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">&quot;400ms ease-out&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 定义折叠动画</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;expanded =&gt; collapsed&quot;</span><span class="token punctuation">,</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">&quot;400ms ease-in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>panel-body<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[@expandCollapse]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isExpended ? 'expanded' : 'collapsed'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_16-9、路由动画"><a href="#_16-9、路由动画" class="header-anchor">#</a> 16.9、路由动画</h3> <p><img src="/web-bookmarks/assets/img/animation-7.f755d11e.gif" alt=""></p> <ol><li>为路由添加状态标识，此标识即为路由执行动画时的自定义状态</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> routes<span class="token operator">:</span> Routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> HomeComponent<span class="token punctuation">,</span>
    pathMatch<span class="token operator">:</span> <span class="token string">&quot;full&quot;</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      animation<span class="token operator">:</span> <span class="token string">&quot;one&quot;</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;about&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> AboutComponent<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      animation<span class="token operator">:</span> <span class="token string">&quot;two&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;news&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> NewsComponent<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
      animation<span class="token operator">:</span> <span class="token string">&quot;three&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><ol start="2"><li>通过路由插座对象获取路由状态标识，并将标识传递给动画的调用者，让动画执行当前要执行的状态是什么</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routerContainer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">[@routerAnimations]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prepareRoute(outlet)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- outlet是路由插座实例对象，上面行就可以使用outlet了 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span> <span class="token attr-name">#outlet</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>outlet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> RouterOutlet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/router&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
  <span class="token function">prepareRoute</span><span class="token punctuation">(</span>outlet<span class="token operator">:</span> RouterOutlet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      outlet <span class="token operator">&amp;&amp;</span>
      outlet<span class="token punctuation">.</span>activatedRouteData <span class="token operator">&amp;&amp;</span>
      outlet<span class="token punctuation">.</span>activatedRouteData<span class="token punctuation">.</span>animation
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>将 routerContainer 设置为相对定位，将它的直接一级子元素设置成绝对定位</li></ol> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* styles.css */</span>
<span class="token selector">.routerContainer</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.routerContainer &gt; *</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>创建动画</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&quot;routerAnimations&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;one =&gt; two, one =&gt; three, two =&gt; three&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span> <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span><span class="token punctuation">,</span> opacity<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">query</span><span class="token punctuation">(</span>
        <span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span>
          <span class="token string">&quot;0.4s ease-in&quot;</span><span class="token punctuation">,</span>
          <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(0)&quot;</span><span class="token punctuation">,</span> opacity<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span>
        <span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span>
          <span class="token string">&quot;0.4s ease-out&quot;</span><span class="token punctuation">,</span>
          <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            transform<span class="token operator">:</span> <span class="token string">&quot;translateX(-100%)&quot;</span><span class="token punctuation">,</span>
            opacity<span class="token operator">:</span> <span class="token number">0</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">transition</span><span class="token punctuation">(</span><span class="token string">&quot;three =&gt; two, three =&gt; one, two =&gt; one&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">query</span><span class="token punctuation">(</span>
      <span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span>
      <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(-100%)&quot;</span><span class="token punctuation">,</span> opacity<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">query</span><span class="token punctuation">(</span>
        <span class="token string">&quot;:enter&quot;</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span>
          <span class="token string">&quot;0.4s ease-in&quot;</span><span class="token punctuation">,</span>
          <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token operator">:</span> <span class="token string">&quot;translateX(0)&quot;</span><span class="token punctuation">,</span> opacity<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">query</span><span class="token punctuation">(</span>
        <span class="token string">&quot;:leave&quot;</span><span class="token punctuation">,</span>
        <span class="token function">animate</span><span class="token punctuation">(</span>
          <span class="token string">&quot;0.4s ease-out&quot;</span><span class="token punctuation">,</span>
          <span class="token function">style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            transform<span class="token operator">:</span> <span class="token string">&quot;translateX(100%)&quot;</span><span class="token punctuation">,</span>
            opacity<span class="token operator">:</span> <span class="token number">0</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>------------【完】---------------</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Neveryu/web-bookmarks/edit/master/summary/notes/angular1.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/10/2025, 2:54:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-bookmarks/summary/notes/angular.html" class="prev">
        Angular 入门笔记（超棒）
      </a></span> <span class="next"><a href="/web-bookmarks/summary/notes/angular2.html">
        Angular 实战中的总结与技术点剖析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/web-bookmarks/assets/js/app.043910a3.js" defer></script><script src="/web-bookmarks/assets/js/2.74e402c0.js" defer></script><script src="/web-bookmarks/assets/js/1.f201e22a.js" defer></script><script src="/web-bookmarks/assets/js/10.354a13ae.js" defer></script>
  </body>
</html>
